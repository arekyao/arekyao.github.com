<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Architecture | YY Every Day]]></title>
  <link href="http://arekyao.github.io/blog/categories/architecture/atom.xml" rel="self"/>
  <link href="http://arekyao.github.io/"/>
  <updated>2013-10-22T00:22:48+08:00</updated>
  <id>http://arekyao.github.io/</id>
  <author>
    <name><![CDATA[Arek.Yao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[How to improve the Performance of System]]></title>
    <link href="http://arekyao.github.io/blog/2013/10/18/how-to-improve-the-performance-of-system/"/>
    <updated>2013-10-18T18:04:00+08:00</updated>
    <id>http://arekyao.github.io/blog/2013/10/18/how-to-improve-the-performance-of-system</id>
    <content type="html"><![CDATA[<h2 id="preface">1,Preface</h2>

<p>Happy families are all alike; every unhappy family is unhappy in its own way.<br />
So does System.</p>

<p>Here is just a simple way to find out what’s ‘unhappy’ in your system.</p>

<h2 id="think-as-time-goes">2,Think as time goes</h2>

<p>There are lots of ways to thinking and find something.<br />
Thinking as time goes is an easy one.</p>

<p>However, what we are going to talking, in fact, is thinking as data flows.</p>

<!-- more -->

<p>Refer to your system, the data will be transferred like this:</p>

<p>UserRequest -&gt; HttpServer -&gt; UIServer -&gt; DataServer -&gt; Database<br />
UserReceiver &lt;- HttpServer &lt;- UIServer &lt;- DataServer &lt;- Database</p>

<h2 id="userrequest--userreceiver">3,UserRequest &amp; UserReceiver</h2>

<p>Those belong to User Client.</p>

<p>User’s Client depends on Environment, where user run his program, like Operating System, like web browser if the program is an webapp, etc.</p>

<p>If you are doing a stress testing on your system, your stress test tools is a factor ,too.</p>

<h2 id="server-machine">4,Server Machine</h2>

<p>Others like httpserver,uiserver, database, etc, are running on your server, your machine.
Server Machine can have four kind of bottleneck.</p>

<ul>
  <li>CPU (see top)</li>
  <li>Swap (see free)</li>
  <li>Network (see iftop)</li>
  <li>Disk (see iotop)</li>
</ul>

<blockquote>
  <p>Where is the bottleneck?” is a good question, so I’ll ask it back to you in different words: 
is the CPU maxed out (see top)? 
Are the disks struggling (iotop)? 
Are you hitting swap (free)? 
Are you filling the network pipe (iftop)? 
                          –  Shish Nov 23 ‘11 at 11:21</p>
</blockquote>

<p>The posts, which will give the detail on User &amp; Machine, is on the way.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Data Mining: R, Python, RapidMiner or Matlab]]></title>
    <link href="http://arekyao.github.io/blog/2013/10/11/data-mining-r-python-rapidminer-or-matlab/"/>
    <updated>2013-10-11T22:04:00+08:00</updated>
    <id>http://arekyao.github.io/blog/2013/10/11/data-mining-r-python-rapidminer-or-matlab</id>
    <content type="html"><![CDATA[<p>In work or study, we have more and more problmes, which can be solved by data mining.</p>

<p>Refer to data mining tools, kinds of stuff some out,such as R, spss, mathematica,etc.
The most popular packages in the industry are SAS and SPSS, but they are quite expensive, so you might wanna have a free one, and better a open source one.</p>

<ul>
  <li>R</li>
  <li>RapidMiner</li>
  <li>python</li>
  <li>Matlab</li>
</ul>

<!-- more -->

<p>Here is a <a href="http://www.kdnuggets.com/2013/06/kdnuggets-annual-software-poll-rapidminer-r-vie-for-first-place.html">poll from KDnuggets</a></p>

<p><img src="/images/blog/top.KDnuggetsAnnual_Software_Poll.png" alt="KDnuggets Annual Software Poll: Data Mining" /></p>

<h2 id="python">1,Python</h2>

<ul>
  <li>script language and interactive</li>
  <li>open source and lots of lib, such as NLTK, scipy, scikit-learn, etc.</li>
  <li>Good for mathematics.</li>
  <li>Limited list of machine learning algorithms.</li>
  <li>Machine learning is not handled uniformly between the different libraries.</li>
  <li>efficiency in training model is little low, comparing C language</li>
  <li>easier to integrate a work flow with other program, because other work may be done by python</li>
  <li>windows/linux/osx/android,etc</li>
</ul>

<h2 id="r">2,R</h2>

<ul>
  <li>Open source</li>
  <li>interactive</li>
  <li>learning curve. Language is pretty different from current mainstream languages like C, C#, C++, Java, PHP and VB.</li>
  <li>Very extensive statistical library.</li>
  <li>Very concise for solving statistical problems.</li>
  <li>a powerful elegant array language in the tradition of APL, Mathematica and MATLAB, but also LISP/Scheme.</li>
  <li>easy to integrate this into a work flow with your other programs. You just spawn an R program and pass input in and read output from a pipe.</li>
  <li>R was created in 1990.</li>
  <li>Less specialized towards data mining</li>
  <li>windows/linuxs/osx</li>
</ul>

<p>Link: <a href="http://www.youtube.com/watch?v=3t8LiXlBL40">Screencast showing how a trained R user can generate a PMML neural network model in 60 seconds</a>.</p>

<h2 id="rapidminer">3,RapidMiner</h2>
<ul>
  <li>an open source statistical and data mining package</li>
  <li>written in Java, easy to transplant across multi-operating system</li>
  <li>Lot of data mining algorithms.</li>
  <li>Good graphics</li>
  <li>It easily reads and writes Excel files and different databases.</li>
  <li>program by piping components together in a graphic ETL workflows</li>
  <li>If you set up an illegal workflows RapidMiner suggest Quick Fixes to make it legal</li>
  <li>hard to learn, however good video tutorials</li>
  <li>can work with R &amp; SPSS</li>
</ul>

<h2 id="matlab">4,Matlab</h2>
<ul>
  <li>good at matrix &amp; plot</li>
  <li>easy program, language grama is like c</li>
  <li>too huge ,too expensive</li>
</ul>

<h4 id="reference">Reference:</h4>

<p>1,http://blog.samibadawi.com/2010/06/orange-r-rapidminer-statistica-and-weka.html<br />
2,http://blog.samibadawi.com/2010/04/r-rapidminer-statistica-ssas-or-weka.html<br />
3,http://orange.biolab.si/<br />
4,http://rapid-i.com/<br />
5,http://cos.name/<br />
6,http://r-ke.info/<br />
7,http://www.kdnuggets.com/2013/06/kdnuggets-annual-software-poll-rapidminer-r-vie-for-first-place.html  </p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Workflow Engine in Python]]></title>
    <link href="http://arekyao.github.io/blog/2013/10/02/workflow-engine-in-python/"/>
    <updated>2013-10-02T07:49:00+08:00</updated>
    <id>http://arekyao.github.io/blog/2013/10/02/workflow-engine-in-python</id>
    <content type="html"><![CDATA[<h2 id="whats-workflow">1,What’s workflow</h2>

<p>A <a href="http://en.wikipedia.org/wiki/Workflow">workflow</a> consists of a sequence of connected steps where each step follows without delay or gap and ends just before the subsequent step may begin.</p>

<p>it’s just a complicated finite statemachine</p>

<h2 id="spiff-workflowhttpsgithubcomknipknapspiffworkflow">2,<a href="https://github.com/knipknap/SpiffWorkflow">Spiff workflow</a></h2>

<p>Spiff Workflow is a library implementing a framework for workflows.
It is based on http://www.workflowpatterns.com and implemented in pure Python.</p>

<!-- more -->
<p>In addition, Spiff Workflow provides a parser and workflow emulation
layer that can be used to create executable Spiff Workflow specifications
from Business Process Model and Notation (BPMN) documents.</p>

<p>For documentation please refer to:</p>

<p>https://github.com/knipknap/SpiffWorkflow/wiki</p>

<h2 id="how-to-make-spiff-workflow-work">3,How to make spiff workflow work</h2>

<p>There are many test cases in test directory, you would know how it works, at least know most parts.</p>

<p>Generally, it can work like this:</p>

<ul>
  <li>a, template ,which define the workflow based on <a href="http://www.workflowpatterns.com/">workflow pattern</a>   </li>
  <li>b, tools  which can transform the template to real object in spiff object  </li>
  <li>c, engine, which is used to make spiff workflow object work like flow,lol  </li>
</ul>

<p>However,there is some trap in it.
you can make it work by function,complete_all() or complete_next()
but you can not know how the flow works by getting ready task,
the right way is by callback function</p>

<p>ps: I was stuck by this for two or three days.</p>

<h2 id="one-better-example-using-spiff-workflow">4, one better example using spiff workflow</h2>

<p>the case code:</p>

<p>```py
# -*- coding: utf-8</p>

<p>import sys, os
sys.path.insert(0, os.path.join(os.path.dirname(<strong>file</strong>),  ‘../../lib’))</p>

<p>from SpiffWorkflow.specs import *
from SpiffWorkflow import Task, Workflow
from SpiffWorkflow.storage import XmlSerializer</p>

<p>def on_entered_cb(workflow, task, taken_path):
    #print “entered:”,task.get_name()
    return True</p>

<p>def on_ready_cb(workflow, task, taken_path):
    #print “ready:”,task.get_name()
    return True</p>

<p>def on_reached_cb(workflow, task, taken_path):
    #print “reached:”,task.get_name()
    return True</p>

<p>def on_complete_cb(workflow, task, taken_path):
    # Record the path.
    print “complete:”,task.get_name()
    #print task.get_description()
    indent = ‘  ‘ * (task._get_depth() - 1)
    taken_path.append(‘%s%s’ % (indent, task.get_name()))
    return True</p>

<p>class QuestionError(Exception):</p>

<pre><code>def __init__(self, value):
    self.value = value

def __str__(self):
    return repr(self.value)
</code></pre>

<p>class QuestionWorkflow(object):
    def <strong>init</strong>(self):
        self.serializer = XmlSerializer()</p>

<pre><code>def set_up(self,filename):
    # Test patterns that are defined in XML format.
    xml = open(filename).read()
    self.wf_spec = WorkflowSpec.deserialize(XmlSerializer(), xml, filename = filename)
    self.taken_path = self.track_workflow(self.wf_spec)
    self.workflow   = Workflow(self.wf_spec)


def run(self, UserSelection, restart=False):

    if restart:
        self.workflow = Workflow(self.wf_spec)

    workflow = self.workflow
    condition_keys = []
    if UserSelection is None:
        UserSelection = {}

    task_data_dict = UserSelection.copy()

    while not workflow.is_completed():
        tasks = workflow.get_tasks(Task.READY)

        for t in tasks:
            print "Ready:", t.task_spec.name
            if  hasattr(t.task_spec, "cond_task_specs"):
                for cond, name in t.task_spec.cond_task_specs:
                    for cond_unit in cond.args:
                        if hasattr(cond_unit, "name"):
                            condition_keys.append(cond_unit.name)
   

        flag_keys_in_user_select = True
        for cond_key in condition_keys:
            if not task_data_dict.has_key(cond_key):
                print cond_key
                flag_keys_in_user_select = False
                break

        if not flag_keys_in_user_select:
            # some tast's condition's key not in input userselect dict
            return

        for t in tasks:
            t.set_data(**task_data_dict)

        workflow.complete_next()

    if not workflow.is_completed():
        raise QuestionError('invalid feature[%s]' % filename)

def print_trace(self):
    path = '\n'.join(self.taken_path) + '\n'
    info = ""
    info += 'the workflowrun path:\n'
    info += '%s\n' % path
    print info


def track_task(self, task_spec, taken_path):

    #reached event call back
    if task_spec.reached_event.is_connected(on_reached_cb):
        task_spec.reached_event.disconnect(on_reached_cb)
    task_spec.reached_event.connect(on_reached_cb, taken_path)

    #completed event call back
    if task_spec.completed_event.is_connected(on_complete_cb):
        task_spec.completed_event.disconnect(on_complete_cb)
    task_spec.completed_event.connect(on_complete_cb, taken_path)

    #enter event call back
    if task_spec.entered_event.is_connected(on_entered_cb):
        task_spec.entered_event.disconnect(on_entered_cb)
    task_spec.entered_event.connect(on_entered_cb, taken_path)

    #ready event call back
    if task_spec.ready_event.is_connected(on_ready_cb):
        task_spec.ready_event.disconnect(on_ready_cb)
    task_spec.ready_event.connect(on_ready_cb, taken_path)



def track_workflow(self, wf_spec, taken_path = None):
    if taken_path is None:
        taken_path = []
    for name in wf_spec.task_specs:
        #print "track_workflow:",name
        self.track_task(wf_spec.task_specs[name], taken_path)
    return taken_path
</code></pre>

<p>if <strong>name</strong> == ‘<strong>main</strong>’:
    qw = QuestionWorkflow()
    qw.set_up(“./case.xml”)
    print “==========1st question==========”
    user_selct = {‘man’:’1’}
    qw.run(user_selct)
    print “==========2nd question==========”
    user_selct = {‘man’:’1’, ‘house’: ‘2’}
    qw.run(user_selct)
    print “==========3rd question==========”
    user_selct = {‘man’:’1’, ‘house’: ‘2’, ‘why’: ‘because you are a hero’}
    qw.run(user_selct)</p>

<pre><code>'''
print "==========4th question========="
user_selct = {'man':'1', 'house': '2', 'role':'5'}
qw.run(user_selct)
'''

print "==========fix some question=========="
user_selct = {'man':'1', 'house': '1', 'role':'5'}
qw.run(user_selct,True)

print 
</code></pre>

<p>```</p>

<p>the template case.xml file</p>

<p>```xml </p>

<?xml version="1.0" encoding="UTF-8"?>
<process-definition name="Daixm Workflow" revision="1.6">
    <description>
    A test workflow that contains all possible tasks.
    </description>

    <!-- Start with an implicit simple split. -->
    <start-task>
        <successor>house_choice</successor>
    </start-task>

    <exclusive-choice name="house_choice">
        <!-- No House -->
        <default-successor>role_choice</default-successor>

        <conditional-successor>
            <equals left-field="house" right-value="1" />
            <successor>build_house</successor>
        </conditional-successor>

        <conditional-successor>
            <equals left-field="house" right-value="2" />
            <successor>buy_house</successor>
        </conditional-successor>
    </exclusive-choice>

    <task name="buy_house">
        <description></description>
        <successor>house_location</successor>
    </task>

    <task name="house_location">
        <successor>house_age</successor>
    </task>

    <task name="house_age">
        <successor>role_choice</successor>
    </task>

    <task name="build_house">
        <successor>role_choice</successor>
    </task>


    <exclusive-choice name="role_choice">
        <!-- No House -->
        <default-successor>no_jobs</default-successor>
        <conditional-successor>
            <equals left-field="role" right-value="1" />
            <successor>jobs_working</successor>
        </conditional-successor>
    </exclusive-choice>


    <task name="no_jobs">
        <successor>last</successor>
    </task>

    <task name="jobs_working">
        <successor>last</successor>
    </task>

    <!-- A final task. -->
    <task name="last">
        <successor>end</successor>
    </task>
</process-definition>

<p>```</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting up Django and your web server with uWSGI and nginx]]></title>
    <link href="http://arekyao.github.io/blog/2013/09/15/setting-up-django-and-your-web-server-with-uwsgi-and-nginx/"/>
    <updated>2013-09-15T21:21:00+08:00</updated>
    <id>http://arekyao.github.io/blog/2013/09/15/setting-up-django-and-your-web-server-with-uwsgi-and-nginx</id>
    <content type="html"><![CDATA[<p>Recently, there are many modules or system in python.</p>

<p>This post, let’s focus on webserver system</p>

<p>Out of <a href="https://wiki.python.org/moin/WebFrameworks">Web Framework for python</a>, the most famous is django.
And the most popular httpserver is nginx, apache, lighttpd.</p>

<p>Python is a script language, how does it communicate with httpserver?</p>

<p>The answer is the sgi or cgi,kind of things, which is used to a bridge.</p>

<p>Here is a tuturial which is aimed at the Django user who wants to set up a production web
server. It takes you through the steps required to set up Django so that it
works nicely with uWSGI and nginx. It covers all three components, providing a
complete stack of web application and server software.</p>

<p><a href="http://djangoproject.com/">Django</a> is a high-level Python Web framework that encourages rapid development and clean, pragmatic design.</p>

<p><a href="http://nginx.org/">nginx</a> (pronounced <em>engine-x</em>) is a free, open-source, high-performance HTTP server and reverse proxy, as well as an IMAP/POP3 proxy server.</p>

<!-- more -->

<h2 id="some-notes-about-this-tutorial">Some notes about this tutorial</h2>

<h3 id="note">Note</h3>

<pre><code>This is a **tutorial**. It is not intended to provide a reference guide,
never mind an exhaustive reference, to the subject of deployment.
</code></pre>

<p>nginx and uWSGI are good choices for Django deployment, but they are not the
only ones, or the ‘official’ ones. There are excellent alternatives to both, and
you are encouraged to investigate them.</p>

<p>The way we deploy Django here is a good way, but it is <strong>not</strong> the <em>only</em> way;
for some purposes it is probably not even the best way.</p>

<p>It is however a reliable and easy way, and the material covered here will
introduce you to concepts and procedures you will need to be familiar with
whatever software you use for deploying Django. By providing you with a working
setup, and rehearsing the steps you must take to get there, it will offer you a
basis for exploring other ways to achieve this.</p>

<h3 id="note-1">Note</h3>

<pre><code>This tutorial makes some assumptions about the system you are using.
</code></pre>

<p>It is assumed that you are using a Unix-like system, and that it features
an aptitude-like package manager. However if you need to ask questions like
“What’s the equivalent of aptitude on Mac OS X?”, you’ll be able to find that
kind of help fairly easily.</p>

<p>While this tutorial assumes Django 1.4 or later, which will automatically create
a wsgi module in your new project, the instructions will work with earlier
versions. You will though need to obtain that Django wsgi module yourself, and
you may find that the Django project directory structure is slightly different.</p>

<h2 id="concept">Concept</h2>

<p>A web server faces the outside world. It can serve files (HTML, images, CSS,
etc) directly from the file system. However, it can’t talk <em>directly</em> to Django
applications; it needs something that will run the application, feed it requests
from web clients (such as browsers) and return responses.</p>

<p>A Web Server Gateway Interface - WSGI - does this job. WSGI_ is a Python standard.</p>

<p><a href="http://wsgi.org/">WSGI</a></p>

<p>uWSGI is a WSGI implementation. In this tutorial we will set up uWSGI so that it
creates a Unix socket, and serves responses to the web server via the WSGI
protocol. At the end, our complete stack of components will look like this:</p>

<pre><code>the web client &lt;-&gt; the web server &lt;-&gt; the socket &lt;-&gt; uwsgi &lt;-&gt; Django
</code></pre>

<h2 id="before-you-start-setting-up-uwsgi">Before you start setting up uWSGI</h2>

<h4 id="virtualenv">virtualenv</h4>

<p>Make sure you are in a virtualenv for the software we need to install (we will
describe how to install a system-wide uwsgi later):</p>

<pre><code>virtualenv uwsgi-tutorial
cd uwsgi-tutorial
source bin/activate
</code></pre>

<h4 id="django">Django</h4>

<p>Install Django into your virtualenv, create a new project, and <code>cd</code> into the
project:</p>

<pre><code>pip install Django
django-admin.py startproject mysite 
cd mysite
</code></pre>

<h4 id="about-the-domain-and-port">About the domain and port</h4>

<p>In this tutorial we will call your domain <code>example.com</code>. Substitute your own
FQDN or IP address.</p>

<p>Throughout, we’ll using port 8000 for the web server to publish on, just like
the Django runserver does by default. You can use whatever port you want of
course, but I have chosen this one so it doesn’t conflict with anything a web
server might be doing already.</p>

<h2 id="basic-uwsgi-installation-and-configuration">Basic uWSGI installation and configuration</h2>

<h4 id="install-uwsgi-into-your-virtualenv">Install uWSGI into your virtualenv</h4>

<pre><code>pip install uwsgi
</code></pre>

<p>Of course there are other ways to install uWSGI, but this one is as good as
any. Remember that you will need to have Python development packages installed. 
In the case of Debian, or Debian-derived systems such as Ubuntu, what you need 
to have installed is <code>pythonX.Y-dev</code>, where X.Y is your version of Python.</p>

<h4 id="basic-test">Basic test</h4>

<p>Create a file called <code>test.py</code>:</p>

<pre><code># test.py
def application(env, start_response):
    start_response('200 OK', [('Content-Type','text/html')])
    return "Hello World"
</code></pre>

<p>Run uWSGI:</p>

<pre><code>uwsgi --http :8000 --wsgi-file test.py
</code></pre>

<p>The options mean:</p>

<ul>
  <li>
    <p><code>http :8000</code>: use protocol http, port 8000 </p>
  </li>
  <li>
    <p><code>wsgi-file test.py</code>: load the specified file, test.py</p>
  </li>
</ul>

<p>This should serve a ‘hello world’ message directly to the browser on port 8000.
Visit:</p>

<pre><code>http://example.com:8000
</code></pre>

<p>to check. If so, it means the following stack of components works:</p>

<pre><code>the web client &lt;-&gt; uWSGI &lt;-&gt; Python
</code></pre>

<h4 id="test-your-django-project">Test your Django project</h4>

<p>Now we want uWSGI to do the same thing, but to run a Django site instead of the
<code>test.py</code> module.</p>

<p>If you haven’t already done so, make sure that your <code>mysite</code> project actually works:</p>

<pre><code>python manage.py runserver 0.0.0.0:8000
</code></pre>

<p>And if it that works, run it using uWSGI:</p>

<pre><code>uwsgi --http :8000 --module mysite.wsgi
</code></pre>

<ul>
  <li><code>module mysite.wsgi</code>: load the specified wsgi module</li>
</ul>

<p>Point your browser at the server; if the site appears, it means uWSGI is able
serve your Django application from your virtualenv, and this stack operates
correctly:</p>

<pre><code>the web client &lt;-&gt; uWSGI &lt;-&gt; Django
</code></pre>

<p>Now normally we won’t have the browser speaking directly to uWSGI. That’s a job
for the webserver, which will act as a go-between.</p>

<h2 id="basic-nginx">Basic nginx</h2>

<h4 id="install-nginx">Install nginx</h4>

<pre><code>sudo apt-get install nginx  
sudo /etc/init.d/nginx start    # start nginx
</code></pre>

<p>And now check that the nginx is serving by visiting it in a web browser on port
80 - you should get a message from nginx: “Welcome to nginx!”. That means these
components of the full stack are working together:</p>

<pre><code>the web client &lt;-&gt; the web server
</code></pre>

<p>If something else <em>is</em> already serving on port 80 and you want to use nginx
there, you’ll have to reconfigure nginx to serve on a different port. For this
tutorial though, we’re going to be using port 8000.</p>

<h4 id="configure-nginx-for-your-site">Configure nginx for your site</h4>

<p>You will need the <code>uwsgi_params</code> file, which is available in the <code>nginx</code>
directory of the uWSGI distribution, or from
https://github.com/nginx/nginx/blob/master/conf/uwsgi_params</p>

<p>Copy it into your project directory. In a moment we will tell nginx to refer to
it.</p>

<p>Now create a file called mysite_nginx.conf, and put this in it:</p>

<pre><code># mysite_nginx.conf

# the upstream component nginx needs to connect to
upstream django {
    # server unix:///path/to/your/mysite/mysite.sock; # for a file socket
    server 127.0.0.1:8001; # for a web port socket (we'll use this first) 
    }
 
# configuration of the server
server {
    # the port your site will be served on
    listen      8000;
    # the domain name it will serve for
    server_name .example.com; # substitute your machine's IP address or FQDN
    charset     utf-8;
   
    # max upload size
    client_max_body_size 75M;   # adjust to taste

    # Django media
    location /media  {
        alias /path/to/your/mysite/mysite/media;  # your Django project's media files - amend as required
    }
   
    location /static {
        alias /path/to/your/mysite/mysite/static; # your Django project's static files - amend as required
    }
   
    # Finally, send all non-media requests to the Django server.
    location / {
        uwsgi_pass  django;
        include     /path/to/your/mysite/uwsgi_params; # the uwsgi_params file you installed
        }
    }
</code></pre>

<p>This conf file tells nginx to serve up media and static files from the
filesystem, as well as handle requests that require Django’s intervention. For a
large deployment it is considered good practice to let one server handle
static/media files, and another handle Django applications, but for now, this
will do just fine.</p>

<p>Symlink to this file from /etc/nginx/sites-enabled so nginx can see it:</p>

<pre><code>sudo ln -s ~/path/to/your/mysite/mysite_nginx.conf /etc/nginx/sites-enabled/
</code></pre>

<h4 id="basic-nginx-test">Basic nginx test</h4>

<p>Restart nginx:</p>

<pre><code>sudo /etc/init.d/nginx restart
</code></pre>

<p>To check that media files are being served correctly, add an image called
<code>media.png</code> to the <code>/path/to/your/project/project/media directory</code>, then
visit http://example.com:8000/media/media.png - if this works, you’ll know at
least that nginx is serving files correctly.</p>

<p>It is worth not just restarting nginx, but actually stopping and then starting
it again, which will inform you if there is a problem, and where it is.</p>

<h2 id="nginx-and-uwsgi-and-testpy">nginx and uWSGI and test.py</h2>

<p>Let’s get nginx to speak to the “hello world” <code>test.py</code> application.</p>

<pre><code>uwsgi --socket :8001 --wsgi-file test.py
</code></pre>

<p>This is nearly the same as before, except this time one of the options is
different:</p>

<ul>
  <li><code>socket :8001</code>: use protocol uwsgi, port 8001 </li>
</ul>

<p>nginx meanwhile has been configured to communicate with uWSGI on that port, and
with the outside world on port 8000. Visit:</p>

<p>http://example.com:8000/</p>

<p>to check. And this is our stack:</p>

<pre><code>the web client &lt;-&gt; the web server &lt;-&gt; the socket &lt;-&gt; uWSGI &lt;-&gt; Python
</code></pre>

<p>Meanwhile, you can try to have a look at the uswgi output at
http://example.com:8001 - but quite probably, it won’t work because your browser
speaks http, not uWSGI, though you should see output from uWSGI in your
terminal.</p>

<h2 id="using-unix-sockets-instead-of-ports">Using Unix sockets instead of ports</h2>

<p>So far we have used a TCP port socket, because it’s simpler, but in fact it’s
better to use Unix sockets than ports - there’s less overhead.</p>

<p>Edit <code>mysite_nginx.conf</code>, changing it to match: </p>

<pre><code>server unix:///path/to/your/mysite/mysite.sock; # for a file socket
# server 127.0.0.1:8001; # for a web port socket (we'll use this first) 
</code></pre>

<p>and restart nginx.</p>

<p>Runs uWSGI again:</p>

<pre><code>uwsgi --socket mysite.sock --wsgi-file test.py 
</code></pre>

<p>This time the <code>socket</code> option tells uWSGI which file to use.</p>

<p>Try http://example.com:8000/ in the browser.</p>

<h4 id="if-that-doesnt-work">If that doesn’t work</h4>

<p>Check your nginx error log(/var/log/nginx/error.log). If you see something like:</p>

<pre><code>connect() to unix:///path/to/your/mysite/mysite.sock failed (13: Permission
denied)
</code></pre>

<p>then probably you need to manage the permissions on the socket so that nginx is
allowed to use it.</p>

<p>Try:</p>

<pre><code>uwsgi --socket mysite.sock --wsgi-file test.py --chmod-socket=666 # (very permissive)
</code></pre>

<p>or:</p>

<pre><code>uwsgi --socket mysite.sock --wsgi-file test.py --chmod-socket=664 # (more sensible) 
</code></pre>

<p>You may also have to add your user to nginx’s group (which is probably
www-data), or vice-versa, so that nginx can read and write to your socket
properly. </p>

<p>It’s worth keeping the output of the nginx log running in a terminal window so
you can easily refer to it while troubleshooting.</p>

<h2 id="running-the-django-application-with-uswgi-and-nginx">Running the Django application with uswgi and nginx</h2>

<p>Let’s run our Django application:</p>

<pre><code>uwsgi --socket mysite.sock --module mysite.wsgi --chmod-socket=664
</code></pre>

<p>Now uWSGI and nginx should be serving up not just a “Hello World” module, but
your Django project.</p>

<h2 id="configuring-uwsgi-to-run-with-a-ini-file">Configuring uWSGI to run with a .ini file</h2>

<p>We can put the same options that we used with uWSGI into a file, and then ask
uWSGI to run with that file. It makes it easier to manage configurations.</p>

<p>Create a file called <code>mysite_uwsgi.ini</code>:</p>

<pre><code># mysite_uwsgi.ini file
[uwsgi]

# Django-related settings
# the base directory (full path)
chdir           = /path/to/your/project 
# Django's wsgi file
module          = project.wsgi
# the virtualenv (full path) 
home            = /path/to/virtualenv

# process-related settings
# master
master          = true
# maximum number of worker processes
processes       = 10
# the socket (use the full path to be safe
socket          = /path/to/your/project/mysite.sock 
# ... with appropriate permissions - may be needed
# chmod-socket    = 664
# clear environment on exit
vacuum          = true           
</code></pre>

<p>And run uswgi using this file:</p>

<pre><code>uwsgi --ini mysite_uwsgi.ini # the --ini option is used to specify a file
</code></pre>

<p>Once again, test that the Django site works as expected.</p>

<h2 id="install-uwsgi-system-wide">Install uWSGI system-wide</h2>

<p>So far, uWSGI is only installed in our virtualenv; we’ll need it installed
system-wide for deployment purposes.</p>

<p>Deactivate your virtualenv:</p>

<pre><code>deactivate
</code></pre>

<p>and install uWSGI system-wide:</p>

<pre><code>sudo pip install uwsgi
                                                         
# Or install LTS (long term support).
pip install http://projects.unbit.it/downloads/uwsgi-lts.tar.gz
</code></pre>

<p>The uWSGI wiki describes several <code>installation procedures</code>_. Before installing
uWSGI system-wide, it’s worth considering which version to choose and the most
apppropriate way of installing it.</p>

<p>.. _installation procedures: http://projects.unbit.it/uwsgi/wiki/Install</p>

<p>Check again that you can still run uWSGI just like you did before:</p>

<pre><code>uwsgi --ini mysite_uwsgi.ini # the --ini option is used to specify a file
</code></pre>

<h2 id="emperor-mode">Emperor mode</h2>

<p>uWSGI can run in ‘emperor’ mode. In this mode it keeps an eye on a directory of
uWSGI config files, and will spawn instances (‘vassals’) for each one it finds.</p>

<p>Whenever a config file is amended, the emperor will automatically restart the
vassal.</p>

<pre><code># create a directory for the vassals
sudo mkdir /etc/uwsgi
sudo mkdir /etc/uwsgi/vassals
# symlink from the default config directory to your config file
sudo ln -s /path/to/your/mysite/mysite_uwsgi.ini /etc/uwsgi/vassals/
# run the emperor
uwsgi --emperor /etc/uwsgi/vassals --uid www-data --gid www-data
</code></pre>

<p>You may need to run uWSGI with sudo:</p>

<pre><code>sudo uwsgi --emperor /etc/uwsgi/vassals --uid www-data --gid www-data
</code></pre>

<p>The options mean:</p>

<ul>
  <li><code>emperor</code>: where to look for vassals (config files)</li>
  <li><code>uid</code>: the user id of the process once it’s started</li>
  <li><code>gid</code>: the group id of the process once it’s started</li>
</ul>

<p>Check the site; it should be running.</p>

<h2 id="make-uwsgi-startup-when-the-system-boots">Make uWSGI startup when the system boots</h2>

<p>The last step is to make it all happen automatically at system startup time.</p>

<p>Edit <code>/etc/rc.local</code> and add:</p>

<pre><code>/usr/local/bin/uwsgi --emperor /etc/uwsgi/vassals --uid www-data --gid www-data
</code></pre>

<p>before the line “exit 0”.</p>

<p>And that should be it!</p>

<h2 id="further-configuration">Further configuration</h2>

<p>It is important to understand that this has been a <em>tutorial</em>, to get you
started. You <strong>do</strong> need to read the nginx and uWSGI documentation, and study
the options available before deployment in a production environment.</p>

<p>Both nginx and uWSGI benefit from friendly communities, who are able to offer
invaluable advice about configuration and usage.</p>

<p>nginx
^^^^^</p>

<p>General configuration of nginx is not within the scope of this tutorial though
you’ll probably want to it to listen on port 80, not 8000, for a production
website.</p>

<p>You also ought to consider at having a separate server for non-Django
serving, of static files for example.</p>

<p>uWSGI
^^^^^</p>

<p>uWSGI supports multiple ways to configure it. See <code>uWSGI's documentation</code> and
<code>examples</code>.</p>

<p>Some uWSGI options have been mentioned in this tutorial; others you ought to
look at for a deployment in production include (listed here with example
settings):</p>

<pre><code>env = DJANGO_SETTINGS_MODULE=mysite.settings # set an environment variable
pidfile = /tmp/project-master.pid # create a pidfile
harakiri = 20 # respawn processes taking more than 20 seconds
limit-as = 128 # limit the project to 128 MB
max-requests = 5000 # respawn processes after serving 5000 requests
daemonize = /var/log/uwsgi/yourproject.log # background the process &amp; log
</code></pre>

<h2 id="copy-from">Copy From:</h2>

<p>https://github.com/unbit/uwsgi-docs/blob/master/tutorials/Django_and_nginx.rst</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Database Overview]]></title>
    <link href="http://arekyao.github.io/blog/2013/04/23/database-overview/"/>
    <updated>2013-04-23T22:46:00+08:00</updated>
    <id>http://arekyao.github.io/blog/2013/04/23/database-overview</id>
    <content type="html"><![CDATA[<h2 id="preface">Preface</h2>

<p>What’s the most important?
Infomation!</p>

<p>How to get and save infomation?
Database.</p>

<p>Here is some story about database.</p>

<p>Generally, database can be divided into two arm, SQL and NoSQL.</p>

<h2 id="sqlhttpenwikipediaorgwikistructuredquerylanguage"><a href="http://en.wikipedia.org/wiki/Structured_Query_Language">SQL</a></h2>

<!-- more -->

<p>SQL (Structured Query Language) is very common.<br />
mysql ,sybase and oracle are well-known as database, which is used a lot</p>

<table class="mytable">
  <thead>
    <tr>
      <th>Source</th>
      <th style="text-align: left">Common name</th>
      <th style="text-align: center">Full name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Microsoft / Sybase</td>
      <td style="text-align: left">T-SQL</td>
      <td style="text-align: center">Transact-SQL</td>
    </tr>
    <tr>
      <td>MySQL</td>
      <td style="text-align: left">SQL/PSM</td>
      <td style="text-align: center">SQL/Persistent Stored Module (implements SQL/PSM)</td>
    </tr>
    <tr>
      <td>Oracle</td>
      <td style="text-align: left">PL/SQL</td>
      <td style="text-align: center">Procedural Language/SQL (based on Ada)</td>
    </tr>
    <tr>
      <td>Sybase</td>
      <td style="text-align: left">Watcom-SQL	SQL Anywhere</td>
      <td style="text-align: center">Watcom-SQL Dialect</td>
    </tr>
  </tbody>
</table>

<h2 id="nosqlhttpenwikipediaorgwikinosql"><a href="http://en.wikipedia.org/wiki/Nosql">NoSQL</a></h2>

<p>Feature:
It provides mechanism for storage and retrieval of data that use looser consistency models than traditional relational databases  </p>

<p>Achieve horizontal scaling and higher availability</p>

<ul>
  <li>
    <h5 id="document-store">Document Store</h5>
  </li>
</ul>

<p>Document is encoded to some 
In general, they all assume that documents <strong>encapsulate</strong> and <strong>encode</strong> data (or information) in some standard formats or encodings.
Such as, XML, Jason, YAML etc.</p>

<table class="mytable">
  <thead>
    <tr>
      <th>Name</th>
      <th style="text-align: left">Language</th>
      <th style="text-align: center">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BaseX</td>
      <td style="text-align: left">Java, XQuery</td>
      <td style="text-align: center">XML database</td>
    </tr>
    <tr>
      <td>Couchbase Server</td>
      <td style="text-align: left">Erlang, C++</td>
      <td style="text-align: center">Support for JSON and binary documents</td>
    </tr>
    <tr>
      <td>Apache CouchDB</td>
      <td style="text-align: left">Erlang</td>
      <td style="text-align: center">JSON store</td>
    </tr>
    <tr>
      <td>MongoDB</td>
      <td style="text-align: left">C++, C#</td>
      <td style="text-align: center">BSON store (binary format JSON)</td>
    </tr>
    <tr>
      <td>SimpleDB</td>
      <td style="text-align: left">Erlang</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td>Oracle NoSQL Database</td>
      <td style="text-align: left">Java</td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <h5 id="graph">Graph</h5>
  </li>
</ul>

<p>The kind of data could be social relations, public transport links, road maps or network topologies, for example.</p>

<ul>
  <li>
    <h5 id="key-value-store">Key Value Store</h5>
    <p>kv cache in RAM  </p>
  </li>
</ul>

<p>Radis </p>

<p>Memcached</p>

<p>Keyvalue stores on solid state or rotating disk</p>

<p>MemcacheDB</p>

<p>MongoDB</p>

<ul>
  <li>
    <h5 id="multivalue-database">Multivalue database</h5>
  </li>
</ul>

<p>InfinityDB</p>

<ul>
  <li>
    <h5 id="object-databasehttpenwikipediaorgwikiobjectdatabase"><a href="http://en.wikipedia.org/wiki/Object_database">Object database</a></h5>
  </li>
  <li>
    <h5 id="tabular">Tabular</h5>
  </li>
</ul>

<p>Apache Accumulo</p>

<p>BigTable</p>

<p>Apache Hbase</p>

<p>Hypertable</p>

<p>Reference</p>

<ol>
  <li><a href="">http://nosql-database.org/</a></li>
</ol>

]]></content>
  </entry>
  
</feed>
