
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>基本数据表示 Basic Data Representations - YY Every Day</title>
  <meta name="author" content="Arek.Yao">
  <link rel="author" href="humans.txt">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  
    
  
  <meta name="description" content="棋盘 the Board 棋盘编码 Square Numbering 棋盘，一个个格子组成，被称为一个’格子数’。『这里也暗含16进制的高位和低位相同』
现在使用的是0x88，这意味着我们能使用16列数据，但是每一行中，只有前面8列是有效的，在使用的，对应着棋盘的8列。 二维棋盘被映射成一维数组 &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://arekyao.github.io/micromax/board_representation.html">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="YY Every Day" type="application/atom+xml">
  <meta name="og:type" content="website" />
  <meta name="og:site_name" content="YY Every Day" />
  <meta name="og:title" content="基本数据表示 Basic Data Representations" />
  <meta name="og:description" content="棋盘 the Board 棋盘编码 Square Numbering 棋盘，一个个格子组成，被称为一个’格子数’。『这里也暗含16进制的高位和低位相同』
现在使用的是0x88，这意味着我们能使用16列数据，但是每一行中，只有前面8列是有效的，在使用的，对应着棋盘的8列。 二维棋盘被映射成一维数组 &hellip;" />
  <meta name="og:url" content="http://arekyao.github.io/micromax/board_representation.html"/>
  <meta name="url" content="http://arekyao.github.io/micromax/board_representation.html">
  
  <meta name="distribution" content="global">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="/">YY Every Day</a>
    <ul class="nav">
      <li><a href="/">Home</a></li>
      <li><a href="/blog/archives">Archives</a></li>
      <li><a href="/tags.html">Tags</a></li>
      <li><a href="/micromax/index.html">micro-Max</a></li>
      <li><a href="/about/">AboutMe</a></li>
    </ul>
    <ul class="nav" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      
    </ul>
      
    <form class="navbar-form" action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:arekyao.github.io" />
        <input class="span2" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
      
    
  </div>
</div>
</nav>
<div class="wrapper_single">
  <div class="container">
    <article class="span8 offset2 article-format" role="article">
      <div role="div">
        
        <header>
          <h1 class="entry-title">基本数据表示 Basic Data Representations</h1>
          
        </header>
        
        <h2 id="the-board-httphomehccnetnlhgmullerboardhtml"><a href="http://home.hccnet.nl/h.g.muller/board.html">棋盘 the Board </a></h2>

<h3 id="square-numbering">棋盘编码 Square Numbering</h3>

<p>棋盘，一个个格子组成，被称为一个’格子数’。『这里也暗含16进制的高位和低位相同』
现在使用的是0x88，这意味着我们能使用16列数据，但是每一行中，只有前面8列是有效的，在使用的，对应着棋盘的8列。  </p>

<p>二维棋盘被映射成一维数组，一行接着一行。
由于这个原因，低4位表示列，高4位表示行。  <br />
这也使得很容易识别棋盘上的每一步是否已经超出棋盘。   </p>

<p>如之前所述，棋子移动到无效的棋盘位子（例如从 h 列到 i 列），<br />
这会使得第8位为1（第 i-p 列为数字8-15，abcdefgh）。<br />
更进一步的说，所有超出棋盘的棋子步法，会超出到无效的位中，并且会使得128的 bit（0x80，16进制） 被设置为1。  </p>

<p>格子数的有效性，在此体现无疑，可以通过与0x88（=136）做位的与运算。
这个常数（也是系统的名字，囧），保存在全局变量M中 ，因为它使用得很多，从而节省了大量的字符。<br />
『该哥们就是千方百计节约字符数呢』
（如果目的不是代码数的多少，而是代码执行速度，这样玩会走向反方向的！）</p>

<p>Squares are designated by a ‘square-number’. The ‘0x88’ system is used, meaning that the the board actually has ranks of 16 squares, but only the first 8 squares of each rank are valid and correspond to the 8 files of the board. The two-dimensional board is mapped into a one-dimensional array, rank after rank. Due to this the 4 lowest-order bits of the square number indicate the file, and the higher-order bits the rank. This makes it easy to recognize moves that fall off the board. On the left and they move to invalid square numbers (e.g. from the h-file to the ‘i-file’), that have the ‘8’-bit set (the i-p file have numbers 8-15). Furthermore, all moves that move off the board at the front or back move to invalid rank, and have the 128 bit set (0x80, in hexadecimal). The validity of a square-number can thus be tested by bitwise anding with 0x88 (=136). This constant (which has given the system its name) is held in the global variable M, since it is used quite a lot, thus saving a lot of characters. (If the aim would not be source size, but speed, one would of course do the opposite!)</p>

<h3 id="the-board-array">棋盘的数组 The Board Array</h3>

<p>程序中的主要数据结构就是这个棋盘数组 b[129]，一个一维数组，以格子数为索引。<br />
由于格子数有较多无用的，所以只有一半的数组真正被用来存储当前棋子的位置。<br />
8个使用的格子和8个未使用的格子不断交替，最高的有效的格子数是0x77=119。<br />
一个用格子数0x80=128来表示的虚拟的格子（一个被全局变量 S 所保存的值）也被包括在这个数组中。  </p>

<p>这个格子数有时会被用作表示一个无效的格子（例如，在某变量能表示哪个格子被 e.p.吃掉的是可能的当没有 e.p.吃掉是可能的） <br />
『这里，e.p.指 :<a href="http://en.wikipedia.org/wiki/Chess#En_passant">En passant</a> 』
这样能使得在程序非故意的（错误的）保存某些东西时，确保程序不会崩溃掉（使得我们在保存格子数时，不需考虑其有效性的问题）</p>

<p>The principal data structure of the program thus is the board array b[129], a one-dimensional array indexed by square-number. Because of the invalid square-numbers, only half of the array is used to store the current chess position. Blocks of 8 used and 8 unused elements alternate, the highest valid square-number is 0x77=119. A dummy square with square-number 0x80=128 (a value held in the global variable S) is included in the array. This square number is sometimes used to indicate an invalid square (e.g. in the variable that indicates on which square e.p. capture is possible when no e.p. captures are possible), to make sure there are no crashes if the program inadvertently stores something there (saving us the trouble of testing the validity of the square number before we store).</p>

<h3 id="printing-the-board">打印棋盘 Printing the Board</h3>

<p>尽管非连续映射到棋盘B[]数组，这是很容易遍历棋盘，跳过无效的。
表达式x = x+9 &amp; ~8，能使x增加至下一个字段。例如，可以使用在第一个for循环的增量。<br />
由于增加9=8+1代替1平方数的平方’a’-‘g’列，’8’位被置位，通过＆〜8处理，它跳过那些无效位。<br />
但是这样相同的处理’h’列中，还给了第’8’位进位，由于加入1。这将重置第’8’位，并将传递进位到下一行『rank』的位中。   （＆〜8，这又会没有效果。）如果我们想环绕遍历从h8回至a1，则行数rank会溢出，可以使用〜M代替〜8，清除’128’位而不是’8’位。  </p>

<p>Despite the non-contiguous mapping of the chess board into the b[] array, it is quite easy to step through all squares on the board, skipping the invalid ones. The expression to step from a field xto the next field, which can, for instance, be used in th increment part of a for-loop, is x = x+9 &amp; ~8;. Due to adding 9 = 8 + 1 in stead of 1 to a square number of a square in the ‘a’-‘g’ file, its ‘8’-bit gets set, which is taken care of by the &amp; ~8, which clears it again. But doing the same in the ‘h’ file also gives a carry into the ‘8’-bit due to the addition of 1. This resets the ‘8’-bit, and passes the carry through to the more-significant bits, i.e. the rank number. (The &amp; ~8 then has no effect.) If we want the board scan to ‘wrap around’ from h8 back to a1, we can and with ~M in stead of ~8, clearing the ‘128’-bit together with the ‘8’-bit when the rank number overflows.</p>

<p>在打印出整个棋盘的代码行（in main()函数中），情况有所不同，因为当我们’溢出’到一个新的行『rank』时，也有一个新的换行打印出。<br />
因此，使用一个常规的for循环（i++），但测试第’8’位是否为1，看是否跑到棋盘的边缘，在这里的printf（）来知道打印什么。<br />
（一个换行符，10，或能代表棋盘格子的东东，n[b[i]&amp;15]）  如果这个测试为真，一个额外i+=7（其中总是为非零，并因此也始终被认为是真），将我们带回下一个有效棋盘格子。</p>

<p>In the line that prints out the board (in main()) things are done a little differently, because the fact that we ‘overflow’ to a new rank also has to result in the printing of a new-line. Thus it uses a normal for-loop (with i++ increment), but tests the ‘8’-bit to see if we run off the board inside the printf() to know what to print (a new-line character, 10, or the representation of the piece on the square, n[b[i]&amp;15]). If this tests true, an extra i += 7 (which always evaluates non-zero, and thus considered true as well) positions us back in front of the next valid square.</p>

<p>下面关键部分已经高亮『当然这里木有如你所想的高亮，请<a href="http://home.hccnet.nl/h.g.muller/board.html">移步</a> 』</p>

<p>Below the declaration and use of the board are highlighted. (Where the original source contained macro’s for for or while loops, these are shown expanded for readability.)</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="cm">/***************************************************************************/</span>
</span><span class="line"><span class="cm">/*                               micro-Max,                                */</span>
</span><span class="line"><span class="cm">/* A chess program smaller than 2KB (of non-blank source), by H.G. Muller  */</span>
</span><span class="line"><span class="cm">/***************************************************************************/</span>
</span><span class="line"><span class="cm">/* version 3.2 (2000 characters) features:                                 */</span>
</span><span class="line"><span class="cm">/* - recursive negamax search                                              */</span>
</span><span class="line"><span class="cm">/* - quiescence search with recaptures                                     */</span>
</span><span class="line"><span class="cm">/* - recapture extensions                                                  */</span>
</span><span class="line"><span class="cm">/* - (internal) iterative deepening                                        */</span>
</span><span class="line"><span class="cm">/* - best-move-first &#39;sorting&#39;                                             */</span>
</span><span class="line"><span class="cm">/* - a hash table storing score and best move                              */</span>
</span><span class="line"><span class="cm">/* - full FIDE rules (expt minor ptomotion) and move-legality checking     */</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define F(I,S,N) for(I=S;I&lt;N;I++)</span>
</span><span class="line"><span class="cp">#define W(A) while(A)</span>
</span><span class="line"><span class="cp">#define K(A,B) *(int*)(T+A+(B&amp;8)+S*(B&amp;7))</span>
</span><span class="line"><span class="cp">#define J(A) K(y+A,b[y])-K(x+A,u)-K(H+A,t)</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define U 16777224</span>
</span><span class="line"><span class="k">struct</span> <span class="n">_</span> <span class="p">{</span><span class="kt">int</span> <span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">;</span><span class="kt">char</span> <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">D</span><span class="p">;}</span> <span class="n">A</span><span class="p">[</span><span class="n">U</span><span class="p">];</span>           <span class="cm">/* hash table, 16M+8 entries*/</span>
</span><span class="line">
</span><span class="line"><span class="kt">int</span> <span class="n">V</span><span class="o">=</span><span class="mi">112</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="mi">136</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">I</span><span class="o">=</span><span class="mf">8e3</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mi">799</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>       <span class="cm">/* V=0x70=rank mask, M=0x88 */</span>
</span><span class="line">
</span><span class="line"><span class="kt">char</span> <span class="n">O</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">L</span><span class="p">,</span>
</span><span class="line"><span class="n">w</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">},</span>                        <span class="cm">/* relative piece values    */</span>
</span><span class="line"><span class="n">o</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="cm">/* step-vector lists */</span>
</span><span class="line">     <span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span>                          <span class="cm">/* 1st dir. in o[] per piece*/</span>
</span><span class="line">     <span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">},</span>                         <span class="cm">/* initial piece setup      */</span>
</span><span class="line"><span class="n">b</span><span class="p">[</span><span class="mi">129</span><span class="p">],</span>                                        <span class="cm">/* board: half of 16x8+dummy*/</span>
</span><span class="line"><span class="n">T</span><span class="p">[</span><span class="mi">1035</span><span class="p">],</span>                                       <span class="cm">/* hash translation table   */</span>
</span><span class="line">
</span><span class="line"><span class="n">n</span><span class="p">[]</span><span class="o">=</span><span class="s">&quot;.?+nkbrq?*?NKBRQ&quot;</span><span class="p">;</span>                        <span class="cm">/* piece symbols on printout*/</span>
</span><span class="line">
</span><span class="line"><span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>    <span class="cm">/* recursive minimax search, k=moving side, n=depth*/</span>
</span><span class="line"><span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">n</span><span class="p">;</span>  <span class="cm">/* (q,l)=window, e=current eval. score, E=e.p. sqr.*/</span>
</span><span class="line"><span class="p">{</span>                       <span class="cm">/* e=score, z=prev.dest; J,Z=hashkeys; return score*/</span>
</span><span class="line"> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">G</span><span class="p">;</span>
</span><span class="line"> <span class="kt">char</span> <span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">B</span><span class="p">;</span>
</span><span class="line"> <span class="k">struct</span> <span class="n">_</span><span class="o">*</span><span class="n">a</span><span class="o">=</span><span class="n">A</span><span class="p">;</span>
</span><span class="line">                                               <span class="cm">/* lookup pos. in hash table*/</span>
</span><span class="line"> <span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">E</span><span class="o">^</span><span class="n">J</span><span class="p">)</span><span class="o">&amp;</span><span class="n">U</span><span class="o">-</span><span class="mi">9</span><span class="p">;</span>                                <span class="cm">/* try 8 consec. locations  */</span>
</span><span class="line"> <span class="n">W</span><span class="p">((</span><span class="n">h</span><span class="o">=</span><span class="n">A</span><span class="p">[</span><span class="o">++</span><span class="n">j</span><span class="p">].</span><span class="n">K</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">h</span><span class="o">-</span><span class="n">Z</span><span class="o">&amp;&amp;--</span><span class="n">i</span><span class="p">);</span>                    <span class="cm">/* first empty or match     */</span>
</span><span class="line"> <span class="n">a</span><span class="o">+=</span><span class="n">i</span><span class="o">?</span><span class="n">j</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                                     <span class="cm">/* dummy A[0] if miss &amp; full*/</span>
</span><span class="line"> <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="p">)</span>                                      <span class="cm">/* hit: pos. is in hash tab */</span>
</span><span class="line"> <span class="p">{</span><span class="n">d</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="p">;</span><span class="n">v</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">V</span><span class="p">;</span><span class="n">X</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="p">;</span>                        <span class="cm">/* examine stored data      */</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span>                                     <span class="cm">/* if depth sufficient:     */</span>
</span><span class="line">  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&gt;=</span><span class="n">l</span><span class="o">|</span><span class="n">X</span><span class="o">&amp;</span><span class="n">S</span><span class="o">&amp;&amp;</span><span class="n">v</span><span class="o">&lt;=</span><span class="n">q</span><span class="o">|</span><span class="n">X</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="k">return</span> <span class="n">v</span><span class="p">;</span>             <span class="cm">/* use if window compatible */</span>
</span><span class="line">   <span class="n">d</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>                                      <span class="cm">/* or use as iter. start    */</span>
</span><span class="line">  <span class="p">}</span><span class="n">X</span><span class="o">&amp;=~</span><span class="n">M</span><span class="p">;</span><span class="n">Y</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Y</span><span class="p">;</span>                               <span class="cm">/*      with best-move hint */</span>
</span><span class="line">  <span class="n">Y</span><span class="o">=</span><span class="n">d</span><span class="o">?</span><span class="n">Y</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                                     <span class="cm">/* don&#39;t try best at d=0    */</span>
</span><span class="line"> <span class="p">}</span><span class="k">else</span> <span class="n">d</span><span class="o">=</span><span class="n">X</span><span class="o">=</span><span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                                <span class="cm">/* start iter., no best yet */</span>
</span><span class="line"> <span class="n">N</span><span class="o">++</span><span class="p">;</span>                                          <span class="cm">/* node count (for timing)  */</span>
</span><span class="line"> <span class="n">W</span><span class="p">(</span><span class="n">d</span><span class="o">++&lt;</span><span class="n">n</span><span class="o">|</span><span class="n">z</span><span class="o">==</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">N</span><span class="o">&lt;</span><span class="mf">1e7</span><span class="o">&amp;</span><span class="n">d</span><span class="o">&lt;</span><span class="mi">98</span><span class="p">)</span>                      <span class="cm">/* iterative deepening loop */</span>
</span><span class="line"> <span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="n">B</span><span class="o">=</span><span class="n">X</span><span class="p">;</span>                                       <span class="cm">/* start scan at prev. best */</span>
</span><span class="line">  <span class="n">Y</span><span class="o">|=</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">Y</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">;</span>                                   <span class="cm">/* request try noncastl. 1st*/</span>
</span><span class="line">  <span class="n">m</span><span class="o">=</span><span class="n">d</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">?-</span><span class="n">I</span><span class="o">:</span><span class="n">e</span><span class="p">;</span>                                  <span class="cm">/* unconsidered:static eval */</span>
</span><span class="line">  <span class="k">do</span><span class="p">{</span><span class="n">u</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>                                   <span class="cm">/* scan board looking for   */</span>
</span><span class="line">   <span class="k">if</span><span class="p">(</span><span class="n">u</span><span class="o">&amp;</span><span class="n">k</span><span class="p">)</span>                                     <span class="cm">/*  own piece (inefficient!)*/</span>
</span><span class="line">   <span class="p">{</span><span class="n">r</span><span class="o">=</span><span class="n">p</span><span class="o">=</span><span class="n">u</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">;</span>                                   <span class="cm">/* p = piece type (set r&gt;0) */</span>
</span><span class="line">    <span class="n">j</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">16</span><span class="p">];</span>                                 <span class="cm">/* first step vector f.piece*/</span>
</span><span class="line">    <span class="n">W</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">p</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?-</span><span class="n">r</span><span class="o">:-</span><span class="n">o</span><span class="p">[</span><span class="o">++</span><span class="n">j</span><span class="p">])</span>                    <span class="cm">/* loop over directions o[] */</span>
</span><span class="line">    <span class="p">{</span><span class="n">A</span><span class="o">:</span>                                        <span class="cm">/* resume normal after best */</span>
</span><span class="line">     <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">F</span><span class="o">=</span><span class="n">G</span><span class="o">=</span><span class="n">S</span><span class="p">;</span>                                <span class="cm">/* (x,y)=move, (F,G)=castl.R*/</span>
</span><span class="line">     <span class="k">do</span><span class="p">{</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">+=</span><span class="n">r</span><span class="p">;</span>                                <span class="cm">/* y traverses ray          */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">Y</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">;</span>                         <span class="cm">/* sneak in prev. best move */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>                            <span class="cm">/* board edge hit           */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;</span><span class="n">y</span><span class="o">==</span><span class="n">E</span><span class="p">)</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">^</span><span class="mi">16</span><span class="p">;</span>                      <span class="cm">/* shift capt.sqr. H if e.p.*/</span>
</span><span class="line">      <span class="n">t</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">&amp;</span><span class="n">k</span><span class="o">|</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;!</span><span class="p">(</span><span class="n">r</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)</span><span class="o">!=!</span><span class="n">t</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>      <span class="cm">/* capt. own, bad pawn mode */</span>
</span><span class="line">      <span class="n">i</span><span class="o">=</span><span class="mi">99</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">];</span>                             <span class="cm">/* value of capt. piece t   */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">||</span><span class="n">E</span><span class="o">-</span><span class="n">S</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">E</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">y</span><span class="o">-</span><span class="n">E</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">E</span><span class="o">-</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="n">m</span><span class="o">=</span><span class="n">I</span><span class="p">;</span>      <span class="cm">/* K capt. or bad castling  */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;=</span><span class="n">l</span><span class="p">)</span><span class="k">goto</span> <span class="n">C</span><span class="p">;</span>                          <span class="cm">/* abort on fail high       */</span>
</span><span class="line">
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">d</span><span class="o">-</span><span class="p">(</span><span class="n">y</span><span class="o">!=</span><span class="n">z</span><span class="p">))</span>                           <span class="cm">/* remaining depth(-recapt.)*/</span>
</span><span class="line">      <span class="p">{</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">?</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                  <span class="cm">/* center positional pts.   */</span>
</span><span class="line">       <span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="n">u</span><span class="o">&amp;</span><span class="mi">31</span><span class="p">;</span>             <span class="cm">/* do move, strip virgin-bit*/</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">G</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)){</span><span class="n">b</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">6</span><span class="p">;</span><span class="n">v</span><span class="o">+=</span><span class="mi">30</span><span class="p">;}</span>             <span class="cm">/* castling: put R &amp; score  */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span>                                 <span class="cm">/* pawns:                   */</span>
</span><span class="line">       <span class="p">{</span><span class="n">v</span><span class="o">-=</span><span class="mi">9</span><span class="o">*</span><span class="p">(((</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">M</span><span class="o">||</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="n">u</span><span class="p">)</span><span class="o">+</span>            <span class="cm">/* structure, undefended    */</span>
</span><span class="line">              <span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">M</span><span class="o">||</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="n">u</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="cm">/*        squares plus bias */</span>
</span><span class="line">        <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">S</span><span class="p">){</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">|=</span><span class="mi">7</span><span class="p">;</span><span class="n">i</span><span class="o">+=</span><span class="n">C</span><span class="p">;}</span>             <span class="cm">/* promote p to Q, add score*/</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line">       <span class="n">v</span><span class="o">=-</span><span class="n">D</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="n">e</span><span class="p">),</span><span class="n">m</span><span class="o">&gt;</span><span class="n">q</span><span class="o">?-</span><span class="n">m</span><span class="o">:-</span><span class="n">q</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="o">-</span><span class="n">v</span><span class="o">-</span><span class="n">i</span><span class="p">,</span>    <span class="cm">/* recursive eval. of reply */</span>
</span><span class="line">            <span class="n">J</span><span class="o">+</span><span class="n">J</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">Z</span><span class="o">+</span><span class="n">J</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">G</span><span class="o">-</span><span class="n">S</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="p">);</span>          <span class="cm">/* J,Z: hash keys           */</span>
</span><span class="line">       <span class="n">v</span><span class="o">-=</span><span class="n">v</span><span class="o">&gt;</span><span class="n">e</span><span class="p">;</span>                                 <span class="cm">/* delayed-gain penalty     */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="o">==</span><span class="mi">9</span><span class="p">)</span>                                <span class="cm">/* called as move-legality  */</span>
</span><span class="line">       <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">!=-</span><span class="n">I</span><span class="o">&amp;</span><span class="n">x</span><span class="o">==</span><span class="n">K</span><span class="o">&amp;</span><span class="n">y</span><span class="o">==</span><span class="n">L</span><span class="p">)</span>                    <span class="cm">/*   checker: if move found */</span>
</span><span class="line">        <span class="p">{</span><span class="n">Q</span><span class="o">=-</span><span class="n">e</span><span class="o">-</span><span class="n">i</span><span class="p">;</span><span class="n">O</span><span class="o">=</span><span class="n">F</span><span class="p">;</span><span class="k">return</span> <span class="n">l</span><span class="p">;}</span>                 <span class="cm">/*   &amp; not in check, signal */</span>
</span><span class="line">        <span class="n">v</span><span class="o">=</span><span class="n">m</span><span class="p">;</span>                                   <span class="cm">/* (prevent fail-lows on    */</span>
</span><span class="line">       <span class="p">}</span>                                       <span class="cm">/*   K-capt. replies)       */</span>
</span><span class="line">       <span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">38</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">u</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="p">;</span>    <span class="cm">/* undo move,G can be dummy */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">Y</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">){</span><span class="n">m</span><span class="o">=</span><span class="n">v</span><span class="p">;</span><span class="n">Y</span><span class="o">&amp;=~</span><span class="mi">8</span><span class="p">;</span><span class="k">goto</span> <span class="n">A</span><span class="p">;}</span>              <span class="cm">/* best=1st done,redo normal*/</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&gt;</span><span class="n">m</span><span class="p">){</span><span class="n">m</span><span class="o">=</span><span class="n">v</span><span class="p">;</span><span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="o">|</span><span class="n">S</span><span class="o">&amp;</span><span class="n">G</span><span class="p">;}</span>               <span class="cm">/* update max, mark with S  */</span>
</span><span class="line">      <span class="p">}</span>                                        <span class="cm">/*          if non castling */</span>
</span><span class="line">      <span class="n">t</span><span class="o">+=</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span>                                  <span class="cm">/* fake capt. for nonsliding*/</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;</span><span class="mi">6</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">&amp;</span><span class="n">V</span><span class="p">)</span><span class="o">==</span><span class="n">S</span>                      <span class="cm">/* pawn on 3rd/6th, or      */</span>
</span><span class="line">          <span class="o">||</span><span class="p">(</span><span class="n">u</span><span class="o">&amp;~</span><span class="mi">24</span><span class="p">)</span><span class="o">==</span><span class="mi">36</span><span class="o">&amp;</span><span class="n">j</span><span class="o">==</span><span class="mi">7</span><span class="o">&amp;&amp;</span>                 <span class="cm">/* virgin K moving sideways,*/</span>
</span><span class="line">          <span class="n">G</span><span class="o">&amp;</span><span class="n">M</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">|</span><span class="mi">7</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)]</span><span class="o">&amp;</span><span class="mi">32</span>          <span class="cm">/* 1st, virgin R in corner G*/</span>
</span><span class="line">          <span class="o">&amp;&amp;!</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span><span class="o">|</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">^</span><span class="mi">2</span><span class="p">])</span>                   <span class="cm">/* 2 empty sqrs. next to R  */</span>
</span><span class="line">      <span class="p">){</span><span class="n">F</span><span class="o">=</span><span class="n">y</span><span class="p">;</span><span class="n">t</span><span class="o">--</span><span class="p">;}</span>                              <span class="cm">/* unfake capt., enable e.p.*/</span>
</span><span class="line">     <span class="p">}</span><span class="n">W</span><span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">);</span>                                   <span class="cm">/* if not capt. continue ray*/</span>
</span><span class="line">  <span class="p">}}}</span><span class="k">while</span><span class="p">((</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">9</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">B</span><span class="p">);</span>                      <span class="cm">/* next sqr. of board, wrap */</span>
</span><span class="line"><span class="nl">C:</span><span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;</span><span class="n">I</span><span class="o">/</span><span class="mi">4</span><span class="o">|</span><span class="n">m</span><span class="o">&lt;-</span><span class="n">I</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="n">d</span><span class="o">=</span><span class="mi">99</span><span class="p">;</span>                        <span class="cm">/* mate is indep. of depth  */</span>
</span><span class="line">  <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="o">+</span><span class="n">I</span><span class="o">?</span><span class="n">m</span><span class="o">:-</span><span class="n">D</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>         <span class="cm">/* best loses K: (stale)mate*/</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)</span><span class="o">!=</span><span class="n">M</span><span class="o">|</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="o">&lt;=</span><span class="n">d</span><span class="p">)</span>                <span class="cm">/* if new/better type/depth:*/</span>
</span><span class="line">  <span class="p">{</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">=</span><span class="n">Z</span><span class="p">;</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">V</span><span class="o">=</span><span class="n">m</span><span class="p">;</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="o">=</span><span class="n">d</span><span class="p">;</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                <span class="cm">/* store in hash,dummy stays*/</span>
</span><span class="line">   <span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">|</span><span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="o">|</span><span class="n">S</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">&lt;</span><span class="n">l</span><span class="p">);</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">;</span>              <span class="cm">/* empty, type (limit/exact)*/</span>
</span><span class="line">  <span class="p">}</span>                                            <span class="cm">/*    encoded in X S,8 bits */</span>
</span><span class="line"><span class="cm">/*if(z==8)printf(&quot;%2d ply, %9d searched, %6d by (%2x,%2x)\n&quot;,d-1,N,m,X,Y&amp;0x77);*/</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line"> <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">){</span><span class="n">K</span><span class="o">=</span><span class="n">X</span><span class="p">;</span><span class="n">L</span><span class="o">=</span><span class="n">Y</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">;}</span>
</span><span class="line"> <span class="k">return</span> <span class="n">m</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">main</span><span class="p">()</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
</span><span class="line">
</span><span class="line"> <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class="line"> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">V</span><span class="p">]</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">]</span><span class="o">+</span><span class="mi">40</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="mi">18</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">96</span><span class="p">]</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span>   <span class="cm">/* initial board setup*/</span>
</span><span class="line">  <span class="n">F</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="n">b</span><span class="p">[</span><span class="mi">16</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mf">3.5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mf">3.5</span><span class="p">);</span>   <span class="cm">/* center-pts table   */</span>
</span><span class="line"> <span class="p">}</span>                                                   <span class="cm">/*(in unused half b[])*/</span>
</span><span class="line"> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1035</span><span class="p">)</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"> <span class="n">W</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                                <span class="cm">/* play loop          */</span>
</span><span class="line"> <span class="p">{</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">121</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; %c&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">8</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">i</span><span class="o">+=</span><span class="mi">7</span><span class="p">)</span><span class="o">?</span><span class="mi">10</span><span class="o">:</span><span class="n">n</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">]);</span> <span class="cm">/* print board        */</span>
</span><span class="line">  <span class="n">p</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="n">W</span><span class="p">((</span><span class="o">*</span><span class="n">p</span><span class="o">++=</span><span class="n">getchar</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">);</span>                        <span class="cm">/* read input line    */</span>
</span><span class="line">  <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">10</span><span class="p">){</span><span class="n">K</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">16</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">;</span><span class="n">L</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">16</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">;}</span><span class="k">else</span>  <span class="cm">/* parse entered move */</span>
</span><span class="line">   <span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>                            <span class="cm">/* or think up one    */</span>
</span><span class="line">  <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">U</span><span class="p">)</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">K</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                                  <span class="cm">/* clear hash table   */</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="n">I</span><span class="p">)</span><span class="n">k</span><span class="o">^=</span><span class="mi">24</span><span class="p">;</span>                 <span class="cm">/* check legality &amp; do*/</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


        
      </div>
    
    </article>
  </div>
</div>
<div id="footer-widgets">
  <div class="container">
    <div class="row">
  <div class="span3">
    <h2>recent posts</h2>
    <ul class="recent_posts">
      
        <li>
          <a href="/blog/2013/10/02/workflow-engine-in-python/">Workflow Engine in Python</a>
        </li>
      
        <li>
          <a href="/blog/2013/07/02/the-key-technologies-in-simple-xiangqi-engine-maxqi/">The Key Technologies in Simple XiangQi Engine MaxQi</a>
        </li>
      
        <li>
          <a href="/blog/2013/06/23/something-about-chess-series-with-ai/">Something about Chess series with AI</a>
        </li>
      
        <li>
          <a href="/blog/2013/04/23/database-overview/">Database Overview</a>
        </li>
      
        <li>
          <a href="/blog/2013/04/21/something-interesting-about-ai/">Something Interesting about AI</a>
        </li>
      
    </ul>
    <h2><a href="/blog/archives">archives</a></h2>
  </div>
  <div class="span3">
  </div>
  <div class="span2">
    <section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
<li><a style="font-size: 165%" href="/tags/diy/">DIY</a></li>
<li><a style="font-size: 126%" href="/tags/justforfun/">JustForFun</a></li>
<li><a style="font-size: 165%" href="/tags/machinelearning/">MachineLearning</a></li>
<li><a style="font-size: 60%" href="/tags/tv/">TV</a></li>
<li><a style="font-size: 165%" href="/tags/baby/">baby</a></li>
<li><a style="font-size: 126%" href="/tags/iphone/">iPhone</a></li>
<li><a style="font-size: 165%" href="/tags/life/">life</a></li>
<li><a style="font-size: 165%" href="/tags/python/">python</a></li>

  </ul>
</section>

  </div>
</div>

  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-left">
  <a href="/">YY Every Day</a>
  - Copyright &copy; 2013 - Arek.Yao
</p>
<p class="pull-right">
  <span>Powered by <a href="http://octopress.org/">Octopress</a>.</span>
  
    <span>Designed by <a href="http://www.AdrianArtiles.com">Adrian Artiles</a>.</span>
  
</p>

  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="/javascripts/libs/jquery-1.7.2.min.js" type="text/javascript"><\/script>')</script>
<script src="/javascripts/libs/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.tweet.js" type="text/javascript"></script>
<script src="/javascripts/jquery.instagram.js" type="text/javascript"></script>
<script src="/javascripts/libs/jquery.masonry.min.js" type="text/javascript"></script>
<script src="/javascripts/custom.js" type="text/javascript"></script>


<script type="text/javascript">
      var disqus_shortname = 'arekyao';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




