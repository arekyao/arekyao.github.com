
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>基本数据表示 Basic Data Representations - YY Every Day</title>
  <meta name="author" content="Arek.Yao">
  <link rel="author" href="humans.txt">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  
    
  
  <meta name="description" content="棋子编码 Piece Encoding 每个棋子都被编码成整数，（这就跟二进制数字电脑上的其它东西一样），当然最终都是 bits。
这些编码利用二进制的特定位去表示特定含义： 第8位，如果为1，表示是白方 第16位，如果为1，表示是黑方 这就使得可以通过位并运算（u&amp;8）， &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://arekyao.github.io/micromax/piece_encoding.html">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="YY Every Day" type="application/atom+xml">
  <meta name="og:type" content="website" />
  <meta name="og:site_name" content="YY Every Day" />
  <meta name="og:title" content="基本数据表示 Basic Data Representations" />
  <meta name="og:description" content="棋子编码 Piece Encoding 每个棋子都被编码成整数，（这就跟二进制数字电脑上的其它东西一样），当然最终都是 bits。
这些编码利用二进制的特定位去表示特定含义： 第8位，如果为1，表示是白方 第16位，如果为1，表示是黑方 这就使得可以通过位并运算（u&amp;8）， &hellip;" />
  <meta name="og:url" content="http://arekyao.github.io/micromax/piece_encoding.html"/>
  <meta name="url" content="http://arekyao.github.io/micromax/piece_encoding.html">
  
  <meta name="distribution" content="global">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="/">YY Every Day</a>
    <ul class="nav">
      <li><a href="/">Home</a></li>
      <li><a href="/blog/archives">Archives</a></li>
    </ul>
    <ul class="nav" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      
    </ul>
      
    <form class="navbar-form" action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:arekyao.github.io" />
        <input class="span2" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
      
    
  </div>
</div>
</nav>
<div class="wrapper_single">
  <div class="container">
    <article class="span8 offset2 article-format" role="article">
      <div role="div">
        
        <header>
          <h1 class="entry-title">基本数据表示 Basic Data Representations</h1>
          
        </header>
        
        <h2 id="piece-encodinghttphomehccnetnlhgmullerencodehtml"><a href="http://home.hccnet.nl/h.g.muller/encode.html">棋子编码 Piece Encoding</a></h2>

<p>每个棋子都被编码成整数，（这就跟二进制数字电脑上的其它东西一样），当然最终都是 bits。<br />
这些编码利用二进制的特定位去表示特定含义：  </p>

<ul>
  <li>第8位，如果为1，表示是白方   </li>
  <li>第16位，如果为1，表示是黑方  </li>
</ul>

<p>这就使得可以通过位并运算（u&amp;8），很容易去判断棋子是否为白方棋子。</p>

<p>代码中变量 k，用于表示哪一方该出手。
k=8，表示白方轮；k=16表示黑方轮。
这就可以通过 u&amp;k 操作来判断应该由哪一方棋子走</p>

<ul>
  <li>第32位，如果为1，表示是该棋子是否处于最初的位子（virgin bit）。
有这个位，是考虑到后续有『王车易位』的操作；这个位对于兵&amp;卒而言，并无意义；</li>
</ul>

<p>Pieces are encoded as integers, which (like anything else on a binary digital computer) are eventually bitpatterns.  The encoding makes use of the binary representation by assigning a specific meaning to some bits of the integer encoding: the ‘8’-bit is used (i.e. set) to indicate a white piece, the ‘16’-bit indicates a black piece. This makes it easy to test if a piece u belongs to white, by bitwise anding with 8 (u&amp;8). The code uses a variable k to indicate the side that should move, which has the value 8 on white’s turn, or 16 for black, so that u&amp;k tells us if a piece belongs to the side to move. The ‘32’-bit is used to indicate that a piece is in the original position (the ‘virgin bit’). (Since this is only important for Kings and Rooks in connection with castling, Micro-Max doesn’t bother to set the virgin bit on pawns.</p>

<ul>
  <li>低3位的 bit：用于表示棋子类型（0-7，表示车，马，像，后，王等），与棋子的归属方（白方，黑方）无关。<br />
基于上述内容，则可知，通过位运算（u&amp;7）获得棋子类型。<br />
用于表示棋子名称的数组（角色，代表棋子类型的，会被打印展示的），可以很简单的试用低4位，作为索引（n[u&amp;15]）  </li>
</ul>

<p>The three low-order bits can be interpreted as a number 0-7 that indicates the piece type, and have a meaning that is independent of piece color. This makes tables that do not have to distingush by color (like piece value w[u&amp;7]) half as small. Tables that would like to make this distinction (like the character to used to represent the piece on printout) can simply be indexed with the 4 low-order bits (n[u&amp;15]).</p>

<p>往上走的兵和往下走的兵被认为是不同的类型（类型分别为1和2）。<br />
每方（白或黑）仅有其中1种兵，向合适的方向前进，当然引擎也是不会将兵往回走的。『不然太囧了』</p>

<p>棋子的编码上，基于进一步的考虑到后续更方便的测试棋子属于某个组，所以棋子的编码上，在能够滑行（移动较多格子，不限格式数量）的棋子编码在更高的值.这样使得:<br />
判断爬行棋子（只能走少数1，2格的）可以通过棋子类型p (=u&amp;7)&lt;5;<br />
判断棋子能否相棋盘中间走（除 R，Q 外）可以通过p&lt;6;<br />
判断兵可以通过p&lt;3;  </p>

<p>完整的棋子类型列表为: {1,2,3,4,5,6,7} = {P+,P-,N,K,B,R,Q}  </p>

<p>P 是兵，pawn<br />
N 是马，knight，骑士<br />
K 是王，king<br />
B 是像，bishop，主教<br />
R 是车，rook<br />
Q 是皇后，queen  </p>

<p>更多的走法，可见<a href="http://en.wikipedia.org/wiki/Chess#Movement">这里</a></p>

<ul>
  <li>类型为0，未试用，当然也可以表示在棋盘格子中为空</li>
</ul>

<p>Upstream moving pawns are considered different pieces than downstream moving pawns (type 1 and 2, respectively). Each side has only one of the types of pawns, moving in the appropriate direction, although the engine would not frown at putting pieces on the board that move ‘backwards’. The encoding is further chosen such that tests if a piece belongs to a certain group is easy: the sliding pieces (BRQ) are giving the highest type numbers (5,6,7), so that crawling pieces can be recognized by piece type p (=u&amp;7) p&lt;5. Pieces that are awarded for moving towards the center of the board (everything but RQ) are recognized by p&lt;6, pawns by p&lt;3. The complete list thus is {1,2,3,4,5,6,7} = {P+,P-,N,K,B,R,Q}. Type 0 is not used, so it can indicate empty squares on the board.</p>

<p>如下高亮代码展示了棋子如何使用的在 micro-max 中。『这里很囧，没有高亮』
<a href="http://home.hccnet.nl/h.g.muller/encode.html">更好的看代码的地址</a></p>

<p>The following highlights places that show how the piece encoding is used in Micro-Max.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="cm">/***************************************************************************/</span>
</span><span class="line"><span class="cm">/*                               micro-Max,                                */</span>
</span><span class="line"><span class="cm">/* A chess program smaller than 2KB (of non-blank source), by H.G. Muller  */</span>
</span><span class="line"><span class="cm">/***************************************************************************/</span>
</span><span class="line"><span class="cm">/* version 3.2 (2000 characters) features:                                 */</span>
</span><span class="line"><span class="cm">/* - recursive negamax search                                              */</span>
</span><span class="line"><span class="cm">/* - quiescence search with recaptures                                     */</span>
</span><span class="line"><span class="cm">/* - recapture extensions                                                  */</span>
</span><span class="line"><span class="cm">/* - (internal) iterative deepening                                        */</span>
</span><span class="line"><span class="cm">/* - best-move-first &#39;sorting&#39;                                             */</span>
</span><span class="line"><span class="cm">/* - a hash table storing score and best move                              */</span>
</span><span class="line"><span class="cm">/* - full FIDE rules (expt minor ptomotion) and move-legality checking     */</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define F(I,S,N) for(I=S;I&lt;N;I++)</span>
</span><span class="line"><span class="cp">#define W(A) while(A)</span>
</span><span class="line"><span class="cp">#define K(A,B) *(int*)(T+A+(B&amp;8)+S*(B&amp;7))</span>
</span><span class="line"><span class="cp">#define J(A) K(y+A,b[y])-K(x+A,u)-K(H+A,t)</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define U 16777224</span>
</span><span class="line"><span class="k">struct</span> <span class="n">_</span> <span class="p">{</span><span class="kt">int</span> <span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">;</span><span class="kt">char</span> <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">D</span><span class="p">;}</span> <span class="n">A</span><span class="p">[</span><span class="n">U</span><span class="p">];</span>           <span class="cm">/* hash table, 16M+8 entries*/</span>
</span><span class="line">
</span><span class="line"><span class="kt">int</span> <span class="n">V</span><span class="o">=</span><span class="mi">112</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="mi">136</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">I</span><span class="o">=</span><span class="mf">8e3</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mi">799</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>       <span class="cm">/* V=0x70=rank mask, M=0x88 */</span>
</span><span class="line">
</span><span class="line"><span class="kt">char</span> <span class="n">O</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">L</span><span class="p">,</span>
</span><span class="line"><span class="n">w</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">},</span>                        <span class="cm">/* relative piece values    */</span>
</span><span class="line"><span class="n">o</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="cm">/* step-vector lists */</span>
</span><span class="line">     <span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span>                          <span class="cm">/* 1st dir. in o[] per piece*/</span>
</span><span class="line">     <span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">},</span>                         <span class="cm">/* initial piece setup      */</span>
</span><span class="line"><span class="n">b</span><span class="p">[</span><span class="mi">129</span><span class="p">],</span>                                        <span class="cm">/* board: half of 16x8+dummy*/</span>
</span><span class="line"><span class="n">T</span><span class="p">[</span><span class="mi">1035</span><span class="p">],</span>                                       <span class="cm">/* hash translation table   */</span>
</span><span class="line">
</span><span class="line"><span class="n">n</span><span class="p">[]</span><span class="o">=</span><span class="s">&quot;.?+nkbrq?*?NKBRQ&quot;</span><span class="p">;</span>                        <span class="cm">/* piece symbols on printout*/</span>
</span><span class="line">
</span><span class="line"><span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>    <span class="cm">/* recursive minimax search, k=moving side, n=depth*/</span>
</span><span class="line"><span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">n</span><span class="p">;</span>  <span class="cm">/* (q,l)=window, e=current eval. score, E=e.p. sqr.*/</span>
</span><span class="line"><span class="p">{</span>                       <span class="cm">/* e=score, z=prev.dest; J,Z=hashkeys; return score*/</span>
</span><span class="line"> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">G</span><span class="p">;</span>
</span><span class="line"> <span class="kt">char</span> <span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">B</span><span class="p">;</span>
</span><span class="line"> <span class="k">struct</span> <span class="n">_</span><span class="o">*</span><span class="n">a</span><span class="o">=</span><span class="n">A</span><span class="p">;</span>
</span><span class="line">                                               <span class="cm">/* lookup pos. in hash table*/</span>
</span><span class="line"> <span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">E</span><span class="o">^</span><span class="n">J</span><span class="p">)</span><span class="o">&amp;</span><span class="n">U</span><span class="o">-</span><span class="mi">9</span><span class="p">;</span>                                <span class="cm">/* try 8 consec. locations  */</span>
</span><span class="line"> <span class="n">W</span><span class="p">((</span><span class="n">h</span><span class="o">=</span><span class="n">A</span><span class="p">[</span><span class="o">++</span><span class="n">j</span><span class="p">].</span><span class="n">K</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">h</span><span class="o">-</span><span class="n">Z</span><span class="o">&amp;&amp;--</span><span class="n">i</span><span class="p">);</span>                    <span class="cm">/* first empty or match     */</span>
</span><span class="line"> <span class="n">a</span><span class="o">+=</span><span class="n">i</span><span class="o">?</span><span class="n">j</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                                     <span class="cm">/* dummy A[0] if miss &amp; full*/</span>
</span><span class="line"> <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="p">)</span>                                      <span class="cm">/* hit: pos. is in hash tab */</span>
</span><span class="line"> <span class="p">{</span><span class="n">d</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="p">;</span><span class="n">v</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">V</span><span class="p">;</span><span class="n">X</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="p">;</span>                        <span class="cm">/* examine stored data      */</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span>                                     <span class="cm">/* if depth sufficient:     */</span>
</span><span class="line">  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&gt;=</span><span class="n">l</span><span class="o">|</span><span class="n">X</span><span class="o">&amp;</span><span class="n">S</span><span class="o">&amp;&amp;</span><span class="n">v</span><span class="o">&lt;=</span><span class="n">q</span><span class="o">|</span><span class="n">X</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="k">return</span> <span class="n">v</span><span class="p">;</span>             <span class="cm">/* use if window compatible */</span>
</span><span class="line">   <span class="n">d</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>                                      <span class="cm">/* or use as iter. start    */</span>
</span><span class="line">  <span class="p">}</span><span class="n">X</span><span class="o">&amp;=~</span><span class="n">M</span><span class="p">;</span><span class="n">Y</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Y</span><span class="p">;</span>                               <span class="cm">/*      with best-move hint */</span>
</span><span class="line">  <span class="n">Y</span><span class="o">=</span><span class="n">d</span><span class="o">?</span><span class="n">Y</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                                     <span class="cm">/* don&#39;t try best at d=0    */</span>
</span><span class="line"> <span class="p">}</span><span class="k">else</span> <span class="n">d</span><span class="o">=</span><span class="n">X</span><span class="o">=</span><span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                                <span class="cm">/* start iter., no best yet */</span>
</span><span class="line"> <span class="n">N</span><span class="o">++</span><span class="p">;</span>                                          <span class="cm">/* node count (for timing)  */</span>
</span><span class="line"> <span class="n">W</span><span class="p">(</span><span class="n">d</span><span class="o">++&lt;</span><span class="n">n</span><span class="o">|</span><span class="n">z</span><span class="o">==</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">N</span><span class="o">&lt;</span><span class="mf">1e7</span><span class="o">&amp;</span><span class="n">d</span><span class="o">&lt;</span><span class="mi">98</span><span class="p">)</span>                      <span class="cm">/* iterative deepening loop */</span>
</span><span class="line"> <span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="n">B</span><span class="o">=</span><span class="n">X</span><span class="p">;</span>                                       <span class="cm">/* start scan at prev. best */</span>
</span><span class="line">  <span class="n">Y</span><span class="o">|=</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">Y</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">;</span>                                   <span class="cm">/* request try noncastl. 1st*/</span>
</span><span class="line">  <span class="n">m</span><span class="o">=</span><span class="n">d</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">?-</span><span class="n">I</span><span class="o">:</span><span class="n">e</span><span class="p">;</span>                                  <span class="cm">/* unconsidered:static eval */</span>
</span><span class="line">  <span class="k">do</span><span class="p">{</span><span class="n">u</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>                                   <span class="cm">/* scan board looking for   */</span>
</span><span class="line">   <span class="k">if</span><span class="p">(</span><span class="n">u</span><span class="o">&amp;</span><span class="n">k</span><span class="p">)</span>                                     <span class="cm">/*  own piece (inefficient!)*/</span>
</span><span class="line">   <span class="p">{</span><span class="n">r</span><span class="o">=</span><span class="n">p</span><span class="o">=</span><span class="n">u</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">;</span>                                   <span class="cm">/* p = piece type (set r&gt;0) */</span>
</span><span class="line">    <span class="n">j</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">16</span><span class="p">];</span>                                 <span class="cm">/* first step vector f.piece*/</span>
</span><span class="line">    <span class="n">W</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">p</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?-</span><span class="n">r</span><span class="o">:-</span><span class="n">o</span><span class="p">[</span><span class="o">++</span><span class="n">j</span><span class="p">])</span>                    <span class="cm">/* loop over directions o[] */</span>
</span><span class="line">    <span class="p">{</span><span class="n">A</span><span class="o">:</span>                                        <span class="cm">/* resume normal after best */</span>
</span><span class="line">     <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">F</span><span class="o">=</span><span class="n">G</span><span class="o">=</span><span class="n">S</span><span class="p">;</span>                                <span class="cm">/* (x,y)=move, (F,G)=castl.R*/</span>
</span><span class="line">     <span class="k">do</span><span class="p">{</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">+=</span><span class="n">r</span><span class="p">;</span>                                <span class="cm">/* y traverses ray          */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">Y</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">;</span>                         <span class="cm">/* sneak in prev. best move */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>                            <span class="cm">/* board edge hit           */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;</span><span class="n">y</span><span class="o">==</span><span class="n">E</span><span class="p">)</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">^</span><span class="mi">16</span><span class="p">;</span>                      <span class="cm">/* shift capt.sqr. H if e.p.*/</span>
</span><span class="line">      <span class="n">t</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">&amp;</span><span class="n">k</span><span class="o">|</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;!</span><span class="p">(</span><span class="n">r</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)</span><span class="o">!=!</span><span class="n">t</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>      <span class="cm">/* capt. own, bad pawn mode */</span>
</span><span class="line">      <span class="n">i</span><span class="o">=</span><span class="mi">99</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">];</span>                             <span class="cm">/* value of capt. piece t   */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">||</span><span class="n">E</span><span class="o">-</span><span class="n">S</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">E</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">y</span><span class="o">-</span><span class="n">E</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">E</span><span class="o">-</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="n">m</span><span class="o">=</span><span class="n">I</span><span class="p">;</span>      <span class="cm">/* K capt. or bad castling  */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;=</span><span class="n">l</span><span class="p">)</span><span class="k">goto</span> <span class="n">C</span><span class="p">;</span>                          <span class="cm">/* abort on fail high       */</span>
</span><span class="line">
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">d</span><span class="o">-</span><span class="p">(</span><span class="n">y</span><span class="o">!=</span><span class="n">z</span><span class="p">))</span>                           <span class="cm">/* remaining depth(-recapt.)*/</span>
</span><span class="line">      <span class="p">{</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">?</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                  <span class="cm">/* center positional pts.   */</span>
</span><span class="line">       <span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="n">u</span><span class="o">&amp;</span><span class="mi">31</span><span class="p">;</span>             <span class="cm">/* do move, strip virgin-bit*/</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">G</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)){</span><span class="n">b</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">6</span><span class="p">;</span><span class="n">v</span><span class="o">+=</span><span class="mi">30</span><span class="p">;}</span>             <span class="cm">/* castling: put R &amp; score  */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span>                                 <span class="cm">/* pawns:                   */</span>
</span><span class="line">       <span class="p">{</span><span class="n">v</span><span class="o">-=</span><span class="mi">9</span><span class="o">*</span><span class="p">(((</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">M</span><span class="o">||</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="n">u</span><span class="p">)</span><span class="o">+</span>            <span class="cm">/* structure, undefended    */</span>
</span><span class="line">              <span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">M</span><span class="o">||</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="n">u</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="cm">/*        squares plus bias */</span>
</span><span class="line">        <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">S</span><span class="p">){</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">|=</span><span class="mi">7</span><span class="p">;</span><span class="n">i</span><span class="o">+=</span><span class="n">C</span><span class="p">;}</span>             <span class="cm">/* promote p to Q, add score*/</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line">       <span class="n">v</span><span class="o">=-</span><span class="n">D</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="n">e</span><span class="p">),</span><span class="n">m</span><span class="o">&gt;</span><span class="n">q</span><span class="o">?-</span><span class="n">m</span><span class="o">:-</span><span class="n">q</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="o">-</span><span class="n">v</span><span class="o">-</span><span class="n">i</span><span class="p">,</span>    <span class="cm">/* recursive eval. of reply */</span>
</span><span class="line">            <span class="n">J</span><span class="o">+</span><span class="n">J</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">Z</span><span class="o">+</span><span class="n">J</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">G</span><span class="o">-</span><span class="n">S</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="p">);</span>          <span class="cm">/* J,Z: hash keys           */</span>
</span><span class="line">       <span class="n">v</span><span class="o">-=</span><span class="n">v</span><span class="o">&gt;</span><span class="n">e</span><span class="p">;</span>                                 <span class="cm">/* delayed-gain penalty     */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="o">==</span><span class="mi">9</span><span class="p">)</span>                                <span class="cm">/* called as move-legality  */</span>
</span><span class="line">       <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">!=-</span><span class="n">I</span><span class="o">&amp;</span><span class="n">x</span><span class="o">==</span><span class="n">K</span><span class="o">&amp;</span><span class="n">y</span><span class="o">==</span><span class="n">L</span><span class="p">)</span>                    <span class="cm">/*   checker: if move found */</span>
</span><span class="line">        <span class="p">{</span><span class="n">Q</span><span class="o">=-</span><span class="n">e</span><span class="o">-</span><span class="n">i</span><span class="p">;</span><span class="n">O</span><span class="o">=</span><span class="n">F</span><span class="p">;</span><span class="k">return</span> <span class="n">l</span><span class="p">;}</span>                 <span class="cm">/*   &amp; not in check, signal */</span>
</span><span class="line">        <span class="n">v</span><span class="o">=</span><span class="n">m</span><span class="p">;</span>                                   <span class="cm">/* (prevent fail-lows on    */</span>
</span><span class="line">       <span class="p">}</span>                                       <span class="cm">/*   K-capt. replies)       */</span>
</span><span class="line">       <span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">38</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">u</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="p">;</span>    <span class="cm">/* undo move,G can be dummy */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">Y</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">){</span><span class="n">m</span><span class="o">=</span><span class="n">v</span><span class="p">;</span><span class="n">Y</span><span class="o">&amp;=~</span><span class="mi">8</span><span class="p">;</span><span class="k">goto</span> <span class="n">A</span><span class="p">;}</span>              <span class="cm">/* best=1st done,redo normal*/</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&gt;</span><span class="n">m</span><span class="p">){</span><span class="n">m</span><span class="o">=</span><span class="n">v</span><span class="p">;</span><span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="o">|</span><span class="n">S</span><span class="o">&amp;</span><span class="n">G</span><span class="p">;}</span>               <span class="cm">/* update max, mark with S  */</span>
</span><span class="line">      <span class="p">}</span>                                        <span class="cm">/*          if non castling */</span>
</span><span class="line">      <span class="n">t</span><span class="o">+=</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span>                                  <span class="cm">/* fake capt. for nonsliding*/</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;</span><span class="mi">6</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">&amp;</span><span class="n">V</span><span class="p">)</span><span class="o">==</span><span class="n">S</span>                      <span class="cm">/* pawn on 3rd/6th, or      */</span>
</span><span class="line">          <span class="o">||</span><span class="p">(</span><span class="n">u</span><span class="o">&amp;~</span><span class="mi">24</span><span class="p">)</span><span class="o">==</span><span class="mi">36</span><span class="o">&amp;</span><span class="n">j</span><span class="o">==</span><span class="mi">7</span><span class="o">&amp;&amp;</span>                 <span class="cm">/* virgin K moving sideways,*/</span>
</span><span class="line">          <span class="n">G</span><span class="o">&amp;</span><span class="n">M</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">|</span><span class="mi">7</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)]</span><span class="o">&amp;</span><span class="mi">32</span>          <span class="cm">/* 1st, virgin R in corner G*/</span>
</span><span class="line">          <span class="o">&amp;&amp;!</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span><span class="o">|</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">^</span><span class="mi">2</span><span class="p">])</span>                   <span class="cm">/* 2 empty sqrs. next to R  */</span>
</span><span class="line">      <span class="p">){</span><span class="n">F</span><span class="o">=</span><span class="n">y</span><span class="p">;</span><span class="n">t</span><span class="o">--</span><span class="p">;}</span>                              <span class="cm">/* unfake capt., enable e.p.*/</span>
</span><span class="line">     <span class="p">}</span><span class="n">W</span><span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">);</span>                                   <span class="cm">/* if not capt. continue ray*/</span>
</span><span class="line">  <span class="p">}}}</span><span class="n">W</span><span class="p">((</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">9</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">B</span><span class="p">);</span>                          <span class="cm">/* next sqr. of board, wrap */</span>
</span><span class="line"><span class="nl">C:</span><span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;</span><span class="n">I</span><span class="o">/</span><span class="mi">4</span><span class="o">|</span><span class="n">m</span><span class="o">&lt;-</span><span class="n">I</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="n">d</span><span class="o">=</span><span class="mi">99</span><span class="p">;</span>                        <span class="cm">/* mate is indep. of depth  */</span>
</span><span class="line">  <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="o">+</span><span class="n">I</span><span class="o">?</span><span class="n">m</span><span class="o">:-</span><span class="n">D</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>         <span class="cm">/* best loses K: (stale)mate*/</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)</span><span class="o">!=</span><span class="n">M</span><span class="o">|</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="o">&lt;=</span><span class="n">d</span><span class="p">)</span>                <span class="cm">/* if new/better type/depth:*/</span>
</span><span class="line">  <span class="p">{</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">=</span><span class="n">Z</span><span class="p">;</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">V</span><span class="o">=</span><span class="n">m</span><span class="p">;</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="o">=</span><span class="n">d</span><span class="p">;</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                <span class="cm">/* store in hash,dummy stays*/</span>
</span><span class="line">   <span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">|</span><span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="o">|</span><span class="n">S</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">&lt;</span><span class="n">l</span><span class="p">);</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">;</span>              <span class="cm">/* empty, type (limit/exact)*/</span>
</span><span class="line">  <span class="p">}</span>                                            <span class="cm">/*    encoded in X S,8 bits */</span>
</span><span class="line"><span class="cm">/*if(z==8)printf(&quot;%2d ply, %9d searched, %6d by (%2x,%2x)\n&quot;,d-1,N,m,X,Y&amp;0x77);*/</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line"> <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">){</span><span class="n">K</span><span class="o">=</span><span class="n">X</span><span class="p">;</span><span class="n">L</span><span class="o">=</span><span class="n">Y</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">;}</span>
</span><span class="line"> <span class="k">return</span> <span class="n">m</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">main</span><span class="p">()</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
</span><span class="line">
</span><span class="line"> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span><span class="line"> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">V</span><span class="p">]</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">]</span><span class="o">+</span><span class="mi">40</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="mi">18</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">96</span><span class="p">]</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span>   <span class="cm">/* initial board setup*/</span>
</span><span class="line">  <span class="n">F</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="n">b</span><span class="p">[</span><span class="mi">16</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mf">3.5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mf">3.5</span><span class="p">);</span>   <span class="cm">/* center-pts table   */</span>
</span><span class="line"> <span class="p">}</span>                                                   <span class="cm">/*(in unused half b[])*/</span>
</span><span class="line"> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1035</span><span class="p">)</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"> <span class="n">W</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                                <span class="cm">/* play loop          */</span>
</span><span class="line"> <span class="p">{</span><span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">121</span><span class="p">)</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; %c&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">8</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">i</span><span class="o">+=</span><span class="mi">7</span><span class="p">)</span><span class="o">?</span><span class="mi">10</span><span class="o">:</span><span class="n">n</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">]);</span> <span class="cm">/* print board        */</span>
</span><span class="line">  <span class="n">p</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="n">W</span><span class="p">((</span><span class="o">*</span><span class="n">p</span><span class="o">++=</span><span class="n">getchar</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">);</span>                        <span class="cm">/* read input line    */</span>
</span><span class="line">  <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">10</span><span class="p">){</span><span class="n">K</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">16</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">;</span><span class="n">L</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">16</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">;}</span><span class="k">else</span>  <span class="cm">/* parse entered move */</span>
</span><span class="line">   <span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>                            <span class="cm">/* or think up one    */</span>
</span><span class="line">  <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">U</span><span class="p">)</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">K</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                                  <span class="cm">/* clear hash table   */</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="n">I</span><span class="p">)</span><span class="n">k</span><span class="o">^=</span><span class="mi">24</span><span class="p">;</span>                 <span class="cm">/* check legality &amp; do*/</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>最初的棋盘开局可能也需要一些解释：<br />
保存在 数组o[]中棋盘类型列表将被拷贝到棋盘的第1行和第8行中。<br />
在第1行中，40=8+32，这是为了设置白方棋子和初始位<br />
在第8行中，48=16+32，这是为了设置黑方棋子和初始位<br />
在18=16+2，9=8+1，这是黑方兵和白方的兵的编码  </p>

<p>The initial boad setup might deserve some explanation: the piece types in the back of the array o[] are copied to the 1st and 8th rank of the board. On the 1st rank 40 = 8 + 32 is added, which sets the ‘white’ and the ‘virgin’ bit. On the 8th rank an extra 8 is added, for a total of 48 = 16 + 32, the ‘black’ and ‘virgin’ bits. The 18 = 16 + 2 and 9 = 8 + 1 are the encodings for a black P- and a white P+, respectively.</p>


        
      </div>
    
    </article>
  </div>
</div>
<div id="footer-widgets">
  <div class="container">
    <div class="row">
  <div class="span3">
    <h2>recent posts</h2>
    <ul class="recent_posts">
      
        <li>
          <a href="/blog/2013/10/02/workflow-engine-in-python/">Workflow Engine in Python</a>
        </li>
      
        <li>
          <a href="/blog/2013/07/02/the-key-technologies-in-simple-xiangqi-engine-maxqi/">The Key Technologies in Simple XiangQi Engine MaxQi</a>
        </li>
      
        <li>
          <a href="/blog/2013/06/23/something-about-chess-series-with-ai/">Something about Chess series with AI</a>
        </li>
      
        <li>
          <a href="/blog/2013/04/23/database-overview/">Database Overview</a>
        </li>
      
        <li>
          <a href="/blog/2013/04/21/something-interesting-about-ai/">Something Interesting about AI</a>
        </li>
      
    </ul>
    <h2><a href="/blog/archives">archives</a></h2>
  </div>
  <div class="span3">
    

  </div>
  <div class="span4">
    

  </div>
  <div class="span2">
    <h2>found on</h2>














  </div>
</div>

  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-left">
  <a href="/">YY Every Day</a>
  - Copyright &copy; 2013 - Arek.Yao
</p>
<p class="pull-right">
  <span>Powered by <a href="http://octopress.org/">Octopress</a>.</span>
  
    <span>Designed by <a href="http://www.AdrianArtiles.com">Adrian Artiles</a>.</span>
  
</p>

  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="/javascripts/libs/jquery-1.7.2.min.js" type="text/javascript"><\/script>')</script>
<script src="/javascripts/libs/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.tweet.js" type="text/javascript"></script>
<script src="/javascripts/jquery.instagram.js" type="text/javascript"></script>
<script src="/javascripts/libs/jquery.masonry.min.js" type="text/javascript"></script>
<script src="/javascripts/custom.js" type="text/javascript"></script>


<script type="text/javascript">
      var disqus_shortname = 'arekyao';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




