
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Micro-Max, 一个短小精干的棋类引擎（仅133行 ） - YY Every Day</title>
  <meta name="author" content="Arek.Yao">
  <link rel="author" href="humans.txt">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  
    
  
  <meta name="description" content="编译 micro-Max Compiling micro-Max Compiler Micro-Max was originally written in Kernighan&amp;Ritchie C, because that allows more compact code than &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://arekyao.github.io/micromax/compile.html">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="YY Every Day" type="application/atom+xml">
  <meta name="og:type" content="website" />
  <meta name="og:site_name" content="YY Every Day" />
  <meta name="og:title" content="Micro-Max, 一个短小精干的棋类引擎（仅133行 ）" />
  <meta name="og:description" content="编译 micro-Max Compiling micro-Max Compiler Micro-Max was originally written in Kernighan&amp;Ritchie C, because that allows more compact code than &hellip;" />
  <meta name="og:url" content="http://arekyao.github.io/micromax/compile.html"/>
  <meta name="url" content="http://arekyao.github.io/micromax/compile.html">
  
  <meta name="distribution" content="global">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="/">YY Every Day</a>
    <ul class="nav">
      <li><a href="/">Home</a></li>
      <li><a href="/blog/archives">Archives</a></li>
      <li><a href="/tags.html">Tags</a></li>
      <li><a href="/categories.html">Categories</a></li>
      <li><a href="/micromax/index.html">micro-Max</a></li>
      <li><a href="/about/">AboutMe</a></li>
    </ul>
    <ul class="nav" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      
    </ul>
      
    <form class="navbar-form" action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:arekyao.github.io" />
        <input class="span2" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
      
    
  </div>
</div>
</nav>
<div class="wrapper_single">
  <div class="container">
    <article class="span8 offset2 article-format" role="article">
      <div role="div">
        
        <header>
          <h1 class="entry-title">Micro-Max, 一个短小精干的棋类引擎（仅133行 ）</h1>
          
        </header>
        
        <h2 id="micro-max">编译 micro-Max</h2>

<h2 id="compiling-micro-max">Compiling micro-Max</h2>

<h4 id="compiler">Compiler</h4>

<p>Micro-Max was originally written in Kernighan&amp;Ritchie C, because that allows more compact code than the ANSI dialect. It can be compiled with gcc, under Windows I use cygwin to run gcc. The command line to compile under cygwin if you also want to be able to run from the normal Windows command prompt is:</p>

<p>gcc -O2 -mno-cygwin max.c -o max.exe<br />
To play you must enter moves in algebraic notation, and to make the computer do a move you should press an extra enter. You can alternate sides whenever you want, the program accepts or plays moves for the side whose turn it is to move. After having done a move, be it yours or his own, micro-Max prints a board with the new position. To quit type control-c.</p>

<p>Adapting the Source</p>

<p>If you want to change the hash-table size, because 192MB is too large for your memory (and the system starts swapping like mad), you should lower the value of U as set by the #define statement. Be sure to pick a size that is a power-of-two plus 8. The simplest way to do this is enter the number in hexadecimal, e.g.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">#define U 0x100008
</span><span class="line">for a hash table of 12MB in stead of 192MB. 0x200008 and 0x400008 are also good values.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>If you want to adjust the time per move, you can change the constant 1e7 in N&lt;1e7. This is the number of nodes that is minimally searched, and the time per move is directly proportional to it. So for faster play you could try 1e6 or even 1e5. Micro-Max finishes the ply it was searching, and this causes strongly variable time per move. The actual number of nodes searched is sometimes up to 10 times larger than the number given, if it starts a deeper search after the prevous one was just under the requested number of nodes.</p>

<p>ANSI C</p>

<p>If your compiler only understands ANSI C, you can copy-paste the listing below. The main difference with the K&amp;R version is the declaration of the routines D() and main(), that needs specification of the types within the argument list, rather than in a separate declaration outside the function body, and that main() now explicitly returns an integer (namely zero). In addition, random() was changed to rand(), because the former does not seem to be universal (gcc recognizes both). To make sure the linker recognizes printf() and getchar() in a C++ environment, the header files stdio.h and math.h are included.</p>

<p>The truly lazy can download an executable that runs under Windows, which uses 48MB hash table and searches 1 million positions.</p>

<p>A source of micro-Max in ANSI C:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="cm">/***************************************************************************/</span>
</span><span class="line"><span class="cm">/*                               micro-Max,                                */</span>
</span><span class="line"><span class="cm">/* A chess program smaller than 2KB (of non-blank source), by H.G. Muller  */</span>
</span><span class="line"><span class="cm">/***************************************************************************/</span>
</span><span class="line"><span class="cm">/* version 3.2 (2000 characters) features:                                 */</span>
</span><span class="line"><span class="cm">/* - recursive negamax search                                              */</span>
</span><span class="line"><span class="cm">/* - quiescence search with recaptures                                     */</span>
</span><span class="line"><span class="cm">/* - recapture extensions                                                  */</span>
</span><span class="line"><span class="cm">/* - (internal) iterative deepening                                        */</span>
</span><span class="line"><span class="cm">/* - best-move-first &#39;sorting&#39;                                             */</span>
</span><span class="line"><span class="cm">/* - a hash table storing score and best move                              */</span>
</span><span class="line"><span class="cm">/* - full FIDE rules (expt minor ptomotion) and move-legality checking     */</span>
</span><span class="line">
</span><span class="line"><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class="line"><span class="cp">#include &lt;math.h&gt;</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define F(I,S,N) for(I=S;I&lt;N;I++)</span>
</span><span class="line"><span class="cp">#define W(A) while(A)</span>
</span><span class="line"><span class="cp">#define K(A,B) *(int*)(T+A+(B&amp;8)+S*(B&amp;7))</span>
</span><span class="line"><span class="cp">#define J(A) K(y+A,b[y])-K(x+A,u)-K(H+A,t)</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define U 16777224</span>
</span><span class="line"><span class="k">struct</span> <span class="n">_</span> <span class="p">{</span><span class="kt">int</span> <span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">;</span><span class="kt">char</span> <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">D</span><span class="p">;}</span> <span class="n">A</span><span class="p">[</span><span class="n">U</span><span class="p">];</span>           <span class="cm">/* hash table, 16M+8 entries*/</span>
</span><span class="line">
</span><span class="line"><span class="kt">int</span> <span class="n">V</span><span class="o">=</span><span class="mi">112</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="mi">136</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">I</span><span class="o">=</span><span class="mf">8e3</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mi">799</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>       <span class="cm">/* V=0x70=rank mask, M=0x88 */</span>
</span><span class="line">
</span><span class="line"><span class="kt">char</span> <span class="n">O</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">L</span><span class="p">,</span>
</span><span class="line"><span class="n">w</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">},</span>                        <span class="cm">/* relative piece values    */</span>
</span><span class="line"><span class="n">o</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="cm">/* step-vector lists */</span>
</span><span class="line">     <span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span>                          <span class="cm">/* 1st dir. in o[] per piece*/</span>
</span><span class="line">     <span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">},</span>                         <span class="cm">/* initial piece setup      */</span>
</span><span class="line"><span class="n">b</span><span class="p">[</span><span class="mi">129</span><span class="p">],</span>                                        <span class="cm">/* board: half of 16x8+dummy*/</span>
</span><span class="line"><span class="n">T</span><span class="p">[</span><span class="mi">1035</span><span class="p">],</span>                                       <span class="cm">/* hash translation table   */</span>
</span><span class="line">
</span><span class="line"><span class="n">n</span><span class="p">[]</span><span class="o">=</span><span class="s">&quot;.?+nkbrq?*?NKBRQ&quot;</span><span class="p">;</span>                        <span class="cm">/* piece symbols on printout*/</span>
</span><span class="line">
</span><span class="line"><span class="kt">int</span> <span class="nf">D</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="kt">int</span> <span class="n">q</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">e</span><span class="p">,</span><span class="kt">int</span> <span class="n">J</span><span class="p">,</span><span class="kt">int</span> <span class="n">Z</span><span class="p">,</span><span class="kt">int</span> <span class="n">E</span><span class="p">,</span><span class="kt">int</span> <span class="n">z</span><span class="p">,</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
</span><span class="line"><span class="cm">/* recursive minimax search, k=moving side, n=depth*/</span>
</span><span class="line"><span class="cm">/* (q,l)=window, e=current eval. score, E=e.p. sqr.*/</span>
</span><span class="line"><span class="cm">/* e=score, z=prev.dest; J,Z=hashkeys; return score*/</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">G</span><span class="p">;</span>
</span><span class="line"> <span class="kt">char</span> <span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">B</span><span class="p">;</span>
</span><span class="line"> <span class="k">struct</span> <span class="n">_</span><span class="o">*</span><span class="n">a</span><span class="o">=</span><span class="n">A</span><span class="p">;</span>
</span><span class="line">                                               <span class="cm">/* lookup pos. in hash table*/</span>
</span><span class="line"> <span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">E</span><span class="o">^</span><span class="n">J</span><span class="p">)</span><span class="o">&amp;</span><span class="n">U</span><span class="o">-</span><span class="mi">9</span><span class="p">;</span>                                <span class="cm">/* try 8 consec. locations  */</span>
</span><span class="line"> <span class="k">while</span><span class="p">((</span><span class="n">h</span><span class="o">=</span><span class="n">A</span><span class="p">[</span><span class="o">++</span><span class="n">j</span><span class="p">].</span><span class="n">K</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">h</span><span class="o">-</span><span class="n">Z</span><span class="o">&amp;&amp;--</span><span class="n">i</span><span class="p">);</span>                <span class="cm">/* first empty or match     */</span>
</span><span class="line"> <span class="n">a</span><span class="o">+=</span><span class="n">i</span><span class="o">?</span><span class="n">j</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                                     <span class="cm">/* dummy A[0] if miss &amp; full*/</span>
</span><span class="line"> <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="p">)</span>                                      <span class="cm">/* hit: pos. is in hash tab */</span>
</span><span class="line"> <span class="p">{</span><span class="n">d</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="p">;</span><span class="n">v</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">V</span><span class="p">;</span><span class="n">X</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="p">;</span>                        <span class="cm">/* examine stored data      */</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span>                                     <span class="cm">/* if depth sufficient:     */</span>
</span><span class="line">  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&gt;=</span><span class="n">l</span><span class="o">|</span><span class="n">X</span><span class="o">&amp;</span><span class="n">S</span><span class="o">&amp;&amp;</span><span class="n">v</span><span class="o">&lt;=</span><span class="n">q</span><span class="o">|</span><span class="n">X</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="k">return</span> <span class="n">v</span><span class="p">;</span>             <span class="cm">/* use if window compatible */</span>
</span><span class="line">   <span class="n">d</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>                                      <span class="cm">/* or use as iter. start    */</span>
</span><span class="line">  <span class="p">}</span><span class="n">X</span><span class="o">&amp;=~</span><span class="n">M</span><span class="p">;</span><span class="n">Y</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Y</span><span class="p">;</span>                               <span class="cm">/*      with best-move hint */</span>
</span><span class="line">  <span class="n">Y</span><span class="o">=</span><span class="n">d</span><span class="o">?</span><span class="n">Y</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                                     <span class="cm">/* don&#39;t try best at d=0    */</span>
</span><span class="line"> <span class="p">}</span><span class="k">else</span> <span class="n">d</span><span class="o">=</span><span class="n">X</span><span class="o">=</span><span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                                <span class="cm">/* start iter., no best yet */</span>
</span><span class="line"> <span class="n">N</span><span class="o">++</span><span class="p">;</span>                                          <span class="cm">/* node count (for timing)  */</span>
</span><span class="line"> <span class="n">W</span><span class="p">(</span><span class="n">d</span><span class="o">++&lt;</span><span class="n">n</span><span class="o">|</span><span class="n">z</span><span class="o">==</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">N</span><span class="o">&lt;</span><span class="mf">1e7</span><span class="o">&amp;</span><span class="n">d</span><span class="o">&lt;</span><span class="mi">98</span><span class="p">)</span>                      <span class="cm">/* iterative deepening loop */</span>
</span><span class="line"> <span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="n">B</span><span class="o">=</span><span class="n">X</span><span class="p">;</span>                                       <span class="cm">/* start scan at prev. best */</span>
</span><span class="line">  <span class="n">Y</span><span class="o">|=</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">Y</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">;</span>                                   <span class="cm">/* request try noncastl. 1st*/</span>
</span><span class="line">  <span class="n">m</span><span class="o">=</span><span class="n">d</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">?-</span><span class="n">I</span><span class="o">:</span><span class="n">e</span><span class="p">;</span>                                  <span class="cm">/* unconsidered:static eval */</span>
</span><span class="line">  <span class="k">do</span><span class="p">{</span><span class="n">u</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>                                   <span class="cm">/* scan board looking for   */</span>
</span><span class="line">   <span class="k">if</span><span class="p">(</span><span class="n">u</span><span class="o">&amp;</span><span class="n">k</span><span class="p">)</span>                                     <span class="cm">/*  own piece (inefficient!)*/</span>
</span><span class="line">   <span class="p">{</span><span class="n">r</span><span class="o">=</span><span class="n">p</span><span class="o">=</span><span class="n">u</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">;</span>                                   <span class="cm">/* p = piece type (set r&gt;0) */</span>
</span><span class="line">    <span class="n">j</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">16</span><span class="p">];</span>                                 <span class="cm">/* first step vector f.piece*/</span>
</span><span class="line">    <span class="n">W</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">p</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?-</span><span class="n">r</span><span class="o">:-</span><span class="n">o</span><span class="p">[</span><span class="o">++</span><span class="n">j</span><span class="p">])</span>                    <span class="cm">/* loop over directions o[] */</span>
</span><span class="line">    <span class="p">{</span><span class="n">A</span><span class="o">:</span>                                        <span class="cm">/* resume normal after best */</span>
</span><span class="line">     <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">F</span><span class="o">=</span><span class="n">G</span><span class="o">=</span><span class="n">S</span><span class="p">;</span>                                <span class="cm">/* (x,y)=move, (F,G)=castl.R*/</span>
</span><span class="line">     <span class="k">do</span><span class="p">{</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">+=</span><span class="n">r</span><span class="p">;</span>                                <span class="cm">/* y traverses ray          */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">Y</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">;</span>                         <span class="cm">/* sneak in prev. best move */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>                            <span class="cm">/* board edge hit           */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;</span><span class="n">y</span><span class="o">==</span><span class="n">E</span><span class="p">)</span><span class="n">H</span><span class="o">=</span><span class="n">y</span><span class="o">^</span><span class="mi">16</span><span class="p">;</span>                      <span class="cm">/* shift capt.sqr. H if e.p.*/</span>
</span><span class="line">      <span class="n">t</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">&amp;</span><span class="n">k</span><span class="o">|</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;!</span><span class="p">(</span><span class="n">r</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)</span><span class="o">!=!</span><span class="n">t</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>      <span class="cm">/* capt. own, bad pawn mode */</span>
</span><span class="line">      <span class="n">i</span><span class="o">=</span><span class="mi">99</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">];</span>                             <span class="cm">/* value of capt. piece t   */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">||</span><span class="n">E</span><span class="o">-</span><span class="n">S</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">E</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">y</span><span class="o">-</span><span class="n">E</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">E</span><span class="o">-</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="n">m</span><span class="o">=</span><span class="n">I</span><span class="p">;</span>      <span class="cm">/* K capt. or bad castling  */</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;=</span><span class="n">l</span><span class="p">)</span><span class="k">goto</span> <span class="n">C</span><span class="p">;</span>                          <span class="cm">/* abort on fail high       */</span>
</span><span class="line">
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">d</span><span class="o">-</span><span class="p">(</span><span class="n">y</span><span class="o">!=</span><span class="n">z</span><span class="p">))</span>                           <span class="cm">/* remaining depth(-recapt.)*/</span>
</span><span class="line">      <span class="p">{</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">?</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>                  <span class="cm">/* center positional pts.   */</span>
</span><span class="line">       <span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="n">u</span><span class="o">&amp;</span><span class="mi">31</span><span class="p">;</span>             <span class="cm">/* do move, strip virgin-bit*/</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">G</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)){</span><span class="n">b</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">6</span><span class="p">;</span><span class="n">v</span><span class="o">+=</span><span class="mi">30</span><span class="p">;}</span>             <span class="cm">/* castling: put R &amp; score  */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span>                                 <span class="cm">/* pawns:                   */</span>
</span><span class="line">       <span class="p">{</span><span class="n">v</span><span class="o">-=</span><span class="mi">9</span><span class="o">*</span><span class="p">(((</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">M</span><span class="o">||</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="n">u</span><span class="p">)</span><span class="o">+</span>            <span class="cm">/* structure, undefended    */</span>
</span><span class="line">              <span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">M</span><span class="o">||</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="n">u</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="cm">/*        squares plus bias */</span>
</span><span class="line">        <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">S</span><span class="p">){</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">|=</span><span class="mi">7</span><span class="p">;</span><span class="n">i</span><span class="o">+=</span><span class="n">C</span><span class="p">;}</span>             <span class="cm">/* promote p to Q, add score*/</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line">       <span class="n">v</span><span class="o">=-</span><span class="n">D</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="n">e</span><span class="p">),</span><span class="n">m</span><span class="o">&gt;</span><span class="n">q</span><span class="o">?-</span><span class="n">m</span><span class="o">:-</span><span class="n">q</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="o">-</span><span class="n">v</span><span class="o">-</span><span class="n">i</span><span class="p">,</span>    <span class="cm">/* recursive eval. of reply */</span>
</span><span class="line">            <span class="n">J</span><span class="o">+</span><span class="n">J</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">Z</span><span class="o">+</span><span class="n">J</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">G</span><span class="o">-</span><span class="n">S</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="p">);</span>          <span class="cm">/* J,Z: hash keys           */</span>
</span><span class="line">       <span class="n">v</span><span class="o">-=</span><span class="n">v</span><span class="o">&gt;</span><span class="n">e</span><span class="p">;</span>                                 <span class="cm">/* delayed-gain penalty     */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="o">==</span><span class="mi">9</span><span class="p">)</span>                                <span class="cm">/* called as move-legality  */</span>
</span><span class="line">       <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">!=-</span><span class="n">I</span><span class="o">&amp;</span><span class="n">x</span><span class="o">==</span><span class="n">K</span><span class="o">&amp;</span><span class="n">y</span><span class="o">==</span><span class="n">L</span><span class="p">)</span>                    <span class="cm">/*   checker: if move found */</span>
</span><span class="line">        <span class="p">{</span><span class="n">Q</span><span class="o">=-</span><span class="n">e</span><span class="o">-</span><span class="n">i</span><span class="p">;</span><span class="n">O</span><span class="o">=</span><span class="n">F</span><span class="p">;</span><span class="k">return</span> <span class="n">l</span><span class="p">;}</span>                 <span class="cm">/*   &amp; not in check, signal */</span>
</span><span class="line">        <span class="n">v</span><span class="o">=</span><span class="n">m</span><span class="p">;</span>                                   <span class="cm">/* (prevent fail-lows on    */</span>
</span><span class="line">       <span class="p">}</span>                                       <span class="cm">/*   K-capt. replies)       */</span>
</span><span class="line">       <span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">38</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">u</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">H</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="p">;</span>    <span class="cm">/* undo move,G can be dummy */</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">Y</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">){</span><span class="n">m</span><span class="o">=</span><span class="n">v</span><span class="p">;</span><span class="n">Y</span><span class="o">&amp;=~</span><span class="mi">8</span><span class="p">;</span><span class="k">goto</span> <span class="n">A</span><span class="p">;}</span>              <span class="cm">/* best=1st done,redo normal*/</span>
</span><span class="line">       <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&gt;</span><span class="n">m</span><span class="p">){</span><span class="n">m</span><span class="o">=</span><span class="n">v</span><span class="p">;</span><span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="o">|</span><span class="n">S</span><span class="o">&amp;</span><span class="n">G</span><span class="p">;}</span>               <span class="cm">/* update max, mark with S  */</span>
</span><span class="line">      <span class="p">}</span>                                        <span class="cm">/*          if non castling */</span>
</span><span class="line">      <span class="n">t</span><span class="o">+=</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span>                                  <span class="cm">/* fake capt. for nonsliding*/</span>
</span><span class="line">      <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&amp;</span><span class="mi">6</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">&amp;</span><span class="n">V</span><span class="p">)</span><span class="o">==</span><span class="n">S</span>                      <span class="cm">/* pawn on 3rd/6th, or      */</span>
</span><span class="line">          <span class="o">||</span><span class="p">(</span><span class="n">u</span><span class="o">&amp;~</span><span class="mi">24</span><span class="p">)</span><span class="o">==</span><span class="mi">36</span><span class="o">&amp;</span><span class="n">j</span><span class="o">==</span><span class="mi">7</span><span class="o">&amp;&amp;</span>                 <span class="cm">/* virgin K moving sideways,*/</span>
</span><span class="line">          <span class="n">G</span><span class="o">&amp;</span><span class="n">M</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">|</span><span class="mi">7</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)]</span><span class="o">&amp;</span><span class="mi">32</span>          <span class="cm">/* 1st, virgin R in corner G*/</span>
</span><span class="line">          <span class="o">&amp;&amp;!</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span><span class="o">|</span><span class="n">b</span><span class="p">[</span><span class="n">G</span><span class="o">^</span><span class="mi">2</span><span class="p">])</span>                   <span class="cm">/* 2 empty sqrs. next to R  */</span>
</span><span class="line">      <span class="p">){</span><span class="n">F</span><span class="o">=</span><span class="n">y</span><span class="p">;</span><span class="n">t</span><span class="o">--</span><span class="p">;}</span>                              <span class="cm">/* unfake capt., enable e.p.*/</span>
</span><span class="line">     <span class="p">}</span><span class="n">W</span><span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">);</span>                                   <span class="cm">/* if not capt. continue ray*/</span>
</span><span class="line">  <span class="p">}}}</span><span class="n">W</span><span class="p">((</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">9</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">B</span><span class="p">);</span>                          <span class="cm">/* next sqr. of board, wrap */</span>
</span><span class="line"><span class="nl">C:</span><span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;</span><span class="n">I</span><span class="o">/</span><span class="mi">4</span><span class="o">|</span><span class="n">m</span><span class="o">&lt;-</span><span class="n">I</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="n">d</span><span class="o">=</span><span class="mi">99</span><span class="p">;</span>                        <span class="cm">/* mate is indep. of depth  */</span>
</span><span class="line">  <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="o">+</span><span class="n">I</span><span class="o">?</span><span class="n">m</span><span class="o">:-</span><span class="n">D</span><span class="p">(</span><span class="mi">24</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>         <span class="cm">/* best loses K: (stale)mate*/</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="o">&amp;</span><span class="n">M</span><span class="p">)</span><span class="o">!=</span><span class="n">M</span><span class="o">|</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="o">&lt;=</span><span class="n">d</span><span class="p">)</span>                <span class="cm">/* if new/better type/depth:*/</span>
</span><span class="line">  <span class="p">{</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">=</span><span class="n">Z</span><span class="p">;</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">V</span><span class="o">=</span><span class="n">m</span><span class="p">;</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">D</span><span class="o">=</span><span class="n">d</span><span class="p">;</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">K</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                <span class="cm">/* store in hash,dummy stays*/</span>
</span><span class="line">   <span class="n">a</span><span class="o">-&gt;</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">|</span><span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="o">|</span><span class="n">S</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">&lt;</span><span class="n">l</span><span class="p">);</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">;</span>              <span class="cm">/* empty, type (limit/exact)*/</span>
</span><span class="line">  <span class="p">}</span>                                            <span class="cm">/*    encoded in X S,8 bits */</span>
</span><span class="line"><span class="cm">/*if(z==8)printf(&quot;%2d ply, %9d searched, %6d by (%2x,%2x)\n&quot;,d-1,N,m,X,Y&amp;0x77);*/</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line"> <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">){</span><span class="n">K</span><span class="o">=</span><span class="n">X</span><span class="p">;</span><span class="n">L</span><span class="o">=</span><span class="n">Y</span><span class="o">&amp;~</span><span class="n">M</span><span class="p">;}</span>
</span><span class="line"> <span class="k">return</span> <span class="n">m</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
</span><span class="line">
</span><span class="line"> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span><span class="line"> <span class="p">{</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">V</span><span class="p">]</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">]</span><span class="o">+</span><span class="mi">40</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="mi">18</span><span class="p">;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">96</span><span class="p">]</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span>   <span class="cm">/* initial board setup*/</span>
</span><span class="line">  <span class="n">F</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="n">b</span><span class="p">[</span><span class="mi">16</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mf">3.5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mf">3.5</span><span class="p">);</span>   <span class="cm">/* center-pts table   */</span>
</span><span class="line"> <span class="p">}</span>                                                   <span class="cm">/*(in unused half b[])*/</span>
</span><span class="line"> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1035</span><span class="p">)</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"> <span class="n">W</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                                <span class="cm">/* play loop          */</span>
</span><span class="line"> <span class="p">{</span><span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">121</span><span class="p">)</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; %c&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">8</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">i</span><span class="o">+=</span><span class="mi">7</span><span class="p">)</span><span class="o">?</span><span class="mi">10</span><span class="o">:</span><span class="n">n</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">]);</span> <span class="cm">/* print board        */</span>
</span><span class="line">  <span class="n">p</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="n">W</span><span class="p">((</span><span class="o">*</span><span class="n">p</span><span class="o">++=</span><span class="n">getchar</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">);</span>                        <span class="cm">/* read input line    */</span>
</span><span class="line">  <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">10</span><span class="p">){</span><span class="n">K</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">16</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">;</span><span class="n">L</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">16</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">;}</span><span class="k">else</span>  <span class="cm">/* parse entered move */</span>
</span><span class="line">   <span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>                            <span class="cm">/* or think up one    */</span>
</span><span class="line">  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">U</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">K</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>                          <span class="cm">/* clear hash table   */</span>
</span><span class="line">  <span class="k">if</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="n">I</span><span class="p">)</span><span class="n">k</span><span class="o">^=</span><span class="mi">24</span><span class="p">;</span>                 <span class="cm">/* check legality &amp; do*/</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line"> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


        
      </div>
    </article>
  </div>
</div>
<div id="footer-widgets">
  <div class="container">
    <div class="row">
  <div class="span3">
    <h2>recent posts</h2>
    <ul class="recent_posts">
      
        <li>
          <a href="/blog/2013/11/04/great-mac-tools-list/">Great Mac Tools List</a>
        </li>
      
        <li>
          <a href="/blog/2013/10/23/surfing-your-keyboard-in-bash-with-shortcut/">Surfing your Keyboard in Bash with Shortcut</a>
        </li>
      
        <li>
          <a href="/blog/2013/10/22/how-to-break-gfw-to-git/">How to break gfw to git</a>
        </li>
      
        <li>
          <a href="/blog/2013/10/18/how-to-improve-the-performance-of-system/">How to improve the Performance of System</a>
        </li>
      
        <li>
          <a href="/blog/2013/10/11/data-mining-r-python-rapidminer-or-matlab/">Data Mining: R, Python, RapidMiner or Matlab</a>
        </li>
      
    </ul>
    <h2><a href="/blog/archives">archives</a></h2>
  </div>
  <div class="span3">
  </div>
  <div class="span3">
  </div>
  <div class="span3">
    <h2>hot tags</h2>
<ul class="tag-cloud">
    <li><a style="font-size: 104%" href="/tags/diy/">DIY</a></li>
<li><a style="font-size: 104%" href="/tags/baby/">baby</a></li>
<li><a style="font-size: 107%" href="/tags/blogger/">blogger</a></li>
<li><a style="font-size: 104%" href="/tags/life/">life</a></li>
<li><a style="font-size: 107%" href="/tags/octopress/">octopress</a></li>
<li><a style="font-size: 110%" href="/tags/python/">python</a></li>

</ul>

    <h2><a href="/tags.html">Tags</a></h2>
  </div>
</div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F654cfc47b6302994615bbe58fa7d9a14' type='text/javascript'%3E%3C/script%3E"));
</script>



  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-left">
  <a href="/">YY Every Day</a>
  - Copyright &copy; 2013 - Arek.Yao
</p>
<p class="pull-right">
  <span>Powered by <a href="http://octopress.org/">Octopress</a>.</span>
  
    <span>Designed by <a href="http://www.AdrianArtiles.com">Adrian Artiles</a>.</span>
  
</p>

  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="/javascripts/libs/jquery-1.7.2.min.js" type="text/javascript"><\/script>')</script>
<script src="/javascripts/libs/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.tweet.js" type="text/javascript"></script>
<script src="/javascripts/jquery.instagram.js" type="text/javascript"></script>
<script src="/javascripts/libs/jquery.masonry.min.js" type="text/javascript"></script>
<script src="/javascripts/custom.js" type="text/javascript"></script>


<script type="text/javascript">
      var disqus_shortname = 'arekyao';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




